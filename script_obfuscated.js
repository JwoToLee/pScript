(function(){var _0x='Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICBDQVIgQmF0Y2ggRXh0cmFjdG9yCi8vIEBuYW1lc3BhY2UgICAgaHR0cDovL3RhbXBlcm1vbmtleS5uZXQvCi8vIEB2ZXJzaW9uICAgICAgMS41Ci8vIEBkZXNjcmlwdGlvbiAgTG9vcCB0aHJvdWdoIGFsbCBDQVJzIGluIHRoZSByZXBvcnQgbGlzdGluZyBhbmQgZXh0cmFjdCBkYXRhIHRvIGRpc3BsYXkgaW4gYSBsZWZ0IHJpYmJvbgovLyBAYXV0aG9yICAgICAgIFlvdQovLyBAbWF0Y2ggICAgICAgIGh0dHBzOi8vaGFlc2wuZ2FlbGVubGlnaHRlbi5jb20vUmVwb3J0aW5nL1JlcG9ydGluZ01hbmFnZW1lbnQqCi8vIEBtYXRjaCAgICAgICAgaHR0cHM6Ly9oYWVzbC5nYWVsZW5saWdodGVuLmNvbS9SZXBvcnRpbmcvUmVwb3J0L0luZGV4LyoKLy8gQGdyYW50ICAgICAgICBHTV9hZGRTdHlsZQovLyBAZ3JhbnQgICAgICAgIEdNX3htbGh0dHBSZXF1ZXN0Ci8vIEBncmFudCAgICAgICAgR01fZ2V0VmFsdWUKLy8gQGdyYW50ICAgICAgICBHTV9zZXRWYWx1ZQovLyA9PS9Vc2VyU2NyaXB0PT0KCihmdW5jdGlvbigpIHsKICAgICd1c2Ugc3RyaWN0JzsKCiAgICAvLyBDb25maWd1cmF0aW9uCiAgICBjb25zdCBBQ0NFU1NfQ09OVFJPTF9VUkwgPSAnaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL0p3b1RvTGVlL3BTY3JpcHQvbWFpbi9hY2Nlc3NfY29udHJvbC5qc29uJzsKICAgIGNvbnN0IENIRUNLX0lOVEVSVkFMID0gNSAqIDYwICogMTAwMDsgLy8gQ2hlY2sgZXZlcnkgNSBtaW51dGVzCiAgICAKICAgIC8vIEdsb2JhbCB2YXJpYWJsZXMgZm9yIGFjY2VzcyBjb250cm9sCiAgICBsZXQgYWNjZXNzQ29udHJvbERhdGEgPSBudWxsOwogICAgbGV0IHVzZXJGaW5nZXJwcmludCA9IG51bGw7CiAgICBsZXQgaXNBdXRob3JpemVkID0gZmFsc2U7CiAgICBsZXQgbGFzdEFjY2Vzc0NoZWNrID0gMDsKCiAgICAvLyBGaW5nZXJwcmludGluZyBmdW5jdGlvbnMKICAgIGZ1bmN0aW9uIGdlbmVyYXRlRmluZ2VycHJpbnQoKSB7CiAgICAgICAgY29uc3QgY29tcG9uZW50cyA9IFtdOwogICAgICAgIAogICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIEJyb3dzZXIgYW5kIHN5c3RlbSBpbmZvCiAgICAgICAgICAgIGNvbXBvbmVudHMucHVzaChuYXZpZ2F0b3IudXNlckFnZW50IHx8ICcnKTsKICAgICAgICAgICAgY29tcG9uZW50cy5wdXNoKG5hdmlnYXRvci5sYW5ndWFnZSB8fCAnJyk7CiAgICAgICAgICAgIGNvbXBvbmVudHMucHVzaChuYXZpZ2F0b3IucGxhdGZvcm0gfHwgJycpOwogICAgICAgICAgICBjb21wb25lbnRzLnB1c2gobmF2aWdhdG9yLmNvb2tpZUVuYWJsZWQgPyAnMScgOiAnMCcpOwogICAgICAgICAgICBjb21wb25lbnRzLnB1c2gobmF2aWdhdG9yLmRvTm90VHJhY2sgfHwgJycpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gU2NyZWVuIGluZm8KICAgICAgICAgICAgY29tcG9uZW50cy5wdXNoKHNjcmVlbi53aWR0aCArICd4JyArIHNjcmVlbi5oZWlnaHQpOwogICAgICAgICAgICBjb21wb25lbnRzLnB1c2goc2NyZWVuLmNvbG9yRGVwdGggfHwgJycpOwogICAgICAgICAgICBjb21wb25lbnRzLnB1c2goc2NyZWVuLnBpeGVsRGVwdGggfHwgJycpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gVGltZXpvbmUKICAgICAgICAgICAgY29tcG9uZW50cy5wdXNoKEludGwuRGF0ZVRpbWVGb3JtYXQoKS5yZXNvbHZlZE9wdGlvbnMoKS50aW1lWm9uZSB8fCAnJyk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBIYXJkd2FyZSBpbmZvCiAgICAgICAgICAgIGNvbXBvbmVudHMucHVzaChuYXZpZ2F0b3IuaGFyZHdhcmVDb25jdXJyZW5jeSB8fCAnJyk7CiAgICAgICAgICAgIGNvbXBvbmVudHMucHVzaChuYXZpZ2F0b3IuZGV2aWNlTWVtb3J5IHx8ICcnKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFdlYkdMIGZpbmdlcnByaW50CiAgICAgICAgICAgIGNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpOwogICAgICAgICAgICBjb25zdCBnbCA9IGNhbnZhcy5nZXRDb250ZXh0KCd3ZWJnbCcpIHx8IGNhbnZhcy5nZXRDb250ZXh0KCdleHBlcmltZW50YWwtd2ViZ2wnKTsKICAgICAgICAgICAgaWYgKGdsKSB7CiAgICAgICAgICAgICAgICBjb25zdCByZW5kZXJlciA9IGdsLmdldFBhcmFtZXRlcihnbC5SRU5ERVJFUikgfHwgJyc7CiAgICAgICAgICAgICAgICBjb25zdCB2ZW5kb3IgPSBnbC5nZXRQYXJhbWV0ZXIoZ2wuVkVORE9SKSB8fCAnJzsKICAgICAgICAgICAgICAgIGNvbXBvbmVudHMucHVzaChyZW5kZXJlciArIHZlbmRvcik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIENhbnZhcyBmaW5nZXJwcmludAogICAgICAgICAgICBjb25zdCBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgICAgICAgY3R4LnRleHRCYXNlbGluZSA9ICd0b3AnOwogICAgICAgICAgICBjdHguZm9udCA9ICcxNHB4IEFyaWFsJzsKICAgICAgICAgICAgY3R4LmZpbGxUZXh0KCdDQVIgRXh0cmFjdG9yIEZpbmdlcnByaW50JywgMiwgMik7CiAgICAgICAgICAgIGNvbXBvbmVudHMucHVzaChjYW52YXMudG9EYXRhVVJMKCkpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gQXVkaW8gY29udGV4dCBmaW5nZXJwcmludAogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgY29uc3QgYXVkaW9DdHggPSBuZXcgKHdpbmRvdy5BdWRpb0NvbnRleHQgfHwgd2luZG93LndlYmtpdEF1ZGlvQ29udGV4dCkoKTsKICAgICAgICAgICAgICAgIGNvbnN0IG9zY2lsbGF0b3IgPSBhdWRpb0N0eC5jcmVhdGVPc2NpbGxhdG9yKCk7CiAgICAgICAgICAgICAgICBjb25zdCBhbmFseXNlciA9IGF1ZGlvQ3R4LmNyZWF0ZUFuYWx5c2VyKCk7CiAgICAgICAgICAgICAgICBjb25zdCBnYWluTm9kZSA9IGF1ZGlvQ3R4LmNyZWF0ZUdhaW4oKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgb3NjaWxsYXRvci5jb25uZWN0KGFuYWx5c2VyKTsKICAgICAgICAgICAgICAgIGFuYWx5c2VyLmNvbm5lY3QoZ2Fpbk5vZGUpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjb21wb25lbnRzLnB1c2goYXVkaW9DdHguc2FtcGxlUmF0ZS50b1N0cmluZygpKTsKICAgICAgICAgICAgICAgIGNvbXBvbmVudHMucHVzaChhbmFseXNlci5mcmVxdWVuY3lCaW5Db3VudC50b1N0cmluZygpKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgYXVkaW9DdHguY2xvc2UoKTsKICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgY29tcG9uZW50cy5wdXNoKCdhdWRpb191bmF2YWlsYWJsZScpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgIGNvbnNvbGUud2FybignRXJyb3IgZ2VuZXJhdGluZyBmaW5nZXJwcmludCBjb21wb25lbnQ6JywgZXJyb3IpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBDcmVhdGUgaGFzaCBvZiBhbGwgY29tcG9uZW50cwogICAgICAgIGNvbnN0IGZpbmdlcnByaW50ID0gYnRvYShjb21wb25lbnRzLmpvaW4oJ3wnKSkucmVwbGFjZSgvW15hLXpBLVowLTldL2csICcnKS5zdWJzdHJpbmcoMCwgMzIpOwogICAgICAgIGNvbnN0IGZ1bGxGaW5nZXJwcmludCA9ICdmcF8nICsgZmluZ2VycHJpbnQ7CiAgICAgICAgCiAgICAgICAgLy8gTG9nIGRldGFpbGVkIGZpbmdlcnByaW50IGluZm9ybWF0aW9uIHRvIGNvbnNvbGUgZm9yIGFkbWluIHB1cnBvc2VzCiAgICAgICAgY29uc29sZS5ncm91cCgn8J+UjSBDQVIgRXh0cmFjdG9yIC0gVXNlciBGaW5nZXJwcmludCBEZXRhaWxzJyk7CiAgICAgICAgY29uc29sZS5sb2coJ/Cfk4sgVVNFUiBGSU5HRVJQUklOVDonLCBmdWxsRmluZ2VycHJpbnQpOwogICAgICAgIGNvbnNvbGUubG9nKCcnKTsKICAgICAgICBjb25zb2xlLmxvZygn8J+UpyBGb3IgQWRtaW46IENvcHkgdGhpcyBmaW5nZXJwcmludCB0byBhZGQgdG8gYWNjZXNzIGNvbnRyb2w6Jyk7CiAgICAgICAgY29uc29sZS5sb2coYCIke2Z1bGxGaW5nZXJwcmludH0iYCk7CiAgICAgICAgY29uc29sZS5sb2coJycpOwogICAgICAgIGNvbnNvbGUubG9nKCfwn5SNIEZpbmdlcnByaW50IENvbXBvbmVudHM6Jyk7CiAgICAgICAgY29uc29sZS5sb2coJ1VzZXIgQWdlbnQ6JywgbmF2aWdhdG9yLnVzZXJBZ2VudCk7CiAgICAgICAgY29uc29sZS5sb2coJ0xhbmd1YWdlOicsIG5hdmlnYXRvci5sYW5ndWFnZSk7CiAgICAgICAgY29uc29sZS5sb2coJ1BsYXRmb3JtOicsIG5hdmlnYXRvci5wbGF0Zm9ybSk7CiAgICAgICAgY29uc29sZS5sb2coJ1NjcmVlbjonLCBzY3JlZW4ud2lkdGggKyAneCcgKyBzY3JlZW4uaGVpZ2h0KTsKICAgICAgICBjb25zb2xlLmxvZygnVGltZXpvbmU6JywgSW50bC5EYXRlVGltZUZvcm1hdCgpLnJlc29sdmVkT3B0aW9ucygpLnRpbWVab25lKTsKICAgICAgICBjb25zb2xlLmxvZygnSGFyZHdhcmUgQ29uY3VycmVuY3k6JywgbmF2aWdhdG9yLmhhcmR3YXJlQ29uY3VycmVuY3kpOwogICAgICAgIGNvbnNvbGUubG9nKCcnKTsKICAgICAgICBjb25zb2xlLmxvZygn8J+UoiBSYXcgQ29tcG9uZW50cyBBcnJheTonKTsKICAgICAgICBjb25zb2xlLmxvZyhjb21wb25lbnRzKTsKICAgICAgICBjb25zb2xlLmdyb3VwRW5kKCk7CiAgICAgICAgCiAgICAgICAgLy8gQWxzbyBzaG93IGEgdGVtcG9yYXJ5IG5vdGlmaWNhdGlvbiBvbiBzY3JlZW4KICAgICAgICBzaG93RmluZ2VycHJpbnROb3RpZmljYXRpb24oZnVsbEZpbmdlcnByaW50KTsKICAgICAgICAKICAgICAgICByZXR1cm4gZnVsbEZpbmdlcnByaW50OwogICAgfQoKICAgIGZ1bmN0aW9uIHNob3dGaW5nZXJwcmludE5vdGlmaWNhdGlvbihmaW5nZXJwcmludCkgewogICAgICAgIGNvbnN0IG5vdGlmaWNhdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgIG5vdGlmaWNhdGlvbi5pZCA9ICdmaW5nZXJwcmludC1ub3RpZmljYXRpb24nOwogICAgICAgIG5vdGlmaWNhdGlvbi5pbm5lckhUTUwgPSBgCiAgICAgICAgICAgIDxkaXYgc3R5bGU9InBvc2l0aW9uOiBmaXhlZDsgdG9wOiAyMHB4OyByaWdodDogMjBweDsgCiAgICAgICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCgxMzVkZWcsICM2YzVjZTcgMCUsICNhMjliZmUgMTAwJSk7IAogICAgICAgICAgICAgICAgICAgICAgICBjb2xvcjogd2hpdGU7IHBhZGRpbmc6IDE1cHggMjBweDsgYm9yZGVyLXJhZGl1czogOHB4OyAKICAgICAgICAgICAgICAgICAgICAgICAgYm94LXNoYWRvdzogMCA0cHggMjBweCByZ2JhKDAsMCwwLDAuMyk7IHotaW5kZXg6IDEwMDA0OyAKICAgICAgICAgICAgICAgICAgICAgICAgZm9udC1mYW1pbHk6ICdDb25zb2xhcycsICdNb25hY28nLCAnQ291cmllciBOZXcnLCBtb25vc3BhY2U7CiAgICAgICAgICAgICAgICAgICAgICAgIG1heC13aWR0aDogMzUwcHg7IGZvbnQtc2l6ZTogMTJweDsgbGluZS1oZWlnaHQ6IDEuNDsiPgogICAgICAgICAgICAgICAgPGRpdiBzdHlsZT0iZm9udC13ZWlnaHQ6IGJvbGQ7IG1hcmdpbi1ib3R0b206IDhweDsgZGlzcGxheTogZmxleDsgYWxpZ24taXRlbXM6IGNlbnRlcjsiPgogICAgICAgICAgICAgICAgICAgIPCflI0gVXNlciBGaW5nZXJwcmludCBHZW5lcmF0ZWQKICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIG9uY2xpY2s9Im5hdmlnYXRvci5jbGlwYm9hcmQud3JpdGVUZXh0KCcke2ZpbmdlcnByaW50fScpLnRoZW4oKCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRleHRDb250ZW50ID0gJ+KckyBDb3BpZWQhJzsKICAgICAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB0aGlzLnRleHRDb250ZW50ID0gJ/Cfk4snLCAyMDAwKTsKICAgICAgICAgICAgICAgICAgICB9KSIgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHlsZT0ibWFyZ2luLWxlZnQ6IGF1dG87IGJhY2tncm91bmQ6IHJnYmEoMjU1LDI1NSwyNTUsMC4yKTsgYm9yZGVyOiBub25lOyAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvcjogd2hpdGU7IGZvbnQtc2l6ZTogMTJweDsgY3Vyc29yOiBwb2ludGVyOyBwYWRkaW5nOiAycHggNnB4OyAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBib3JkZXItcmFkaXVzOiAzcHg7Ij7wn5OLPC9idXR0b24+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9ImJhY2tncm91bmQ6IHJnYmEoMCwwLDAsMC4yKTsgcGFkZGluZzogOHB4OyBib3JkZXItcmFkaXVzOiA0cHg7IAogICAgICAgICAgICAgICAgICAgICAgICAgICBmb250LWZhbWlseTogbW9ub3NwYWNlOyB3b3JkLWJyZWFrOiBicmVhay1hbGw7IG1hcmdpbi1ib3R0b206IDhweDsiPgogICAgICAgICAgICAgICAgICAgICR7ZmluZ2VycHJpbnR9CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9ImZvbnQtc2l6ZTogMTBweDsgb3BhY2l0eTogMC45OyI+CiAgICAgICAgICAgICAgICAgICAgQ2hlY2sgY29uc29sZSAoRjEyKSBmb3IgZGV0YWlsZWQgaW5mb3JtYXRpb24KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPGJ1dHRvbiBvbmNsaWNrPSJ0aGlzLnBhcmVudEVsZW1lbnQucGFyZW50RWxlbWVudC5yZW1vdmUoKSIgCiAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlPSJwb3NpdGlvbjogYWJzb2x1dGU7IHRvcDogNXB4OyByaWdodDogNXB4OyAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmQ6IG5vbmU7IGJvcmRlcjogbm9uZTsgY29sb3I6IHdoaXRlOyAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvbnQtc2l6ZTogMTZweDsgY3Vyc29yOiBwb2ludGVyOyBwYWRkaW5nOiAwOyB3aWR0aDogMjBweDsgaGVpZ2h0OiAyMHB4OyI+CiAgICAgICAgICAgICAgICAgICAgw5cKICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICBgOwogICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQobm90aWZpY2F0aW9uKTsKICAgICAgICAKICAgICAgICAvLyBBdXRvLXJlbW92ZSBhZnRlciAzMCBzZWNvbmRzCiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgIGlmIChub3RpZmljYXRpb24ucGFyZW50RWxlbWVudCkgewogICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uLnJlbW92ZSgpOwogICAgICAgICAgICB9CiAgICAgICAgfSwgMzAwMDApOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldFVzZXJGaW5nZXJwcmludCgpIHsKICAgICAgICAvLyBUcnkgdG8gZ2V0IHN0b3JlZCBmaW5nZXJwcmludCBmaXJzdAogICAgICAgIGxldCBmaW5nZXJwcmludCA9IEdNX2dldFZhbHVlKCd1c2VyRmluZ2VycHJpbnQnLCBudWxsKTsKICAgICAgICAKICAgICAgICBpZiAoIWZpbmdlcnByaW50KSB7CiAgICAgICAgICAgIC8vIEdlbmVyYXRlIG5ldyBmaW5nZXJwcmludAogICAgICAgICAgICBmaW5nZXJwcmludCA9IGdlbmVyYXRlRmluZ2VycHJpbnQoKTsKICAgICAgICAgICAgR01fc2V0VmFsdWUoJ3VzZXJGaW5nZXJwcmludCcsIGZpbmdlcnByaW50KTsKICAgICAgICAgICAgY29uc29sZS5sb2coJ0dlbmVyYXRlZCBuZXcgdXNlciBmaW5nZXJwcmludDonLCBmaW5nZXJwcmludCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY29uc29sZS5sb2coJ1JldHJpZXZlZCBzdG9yZWQgZmluZ2VycHJpbnQ6JywgZmluZ2VycHJpbnQpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICByZXR1cm4gZmluZ2VycHJpbnQ7CiAgICB9CgogICAgLy8gQWNjZXNzIGNvbnRyb2wgZnVuY3Rpb25zCiAgICBhc3luYyBmdW5jdGlvbiBmZXRjaEFjY2Vzc0NvbnRyb2woKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgY29uc29sZS5sb2coJ0ZldGNoaW5nIGFjY2VzcyBjb250cm9sIGNvbmZpZ3VyYXRpb24uLi4nKTsKICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChBQ0NFU1NfQ09OVFJPTF9VUkwgKyAnP3Q9JyArIERhdGUubm93KCksIHsKICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsCiAgICAgICAgICAgICAgICBjYWNoZTogJ25vLWNhY2hlJywKICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgICAgICAnQ2FjaGUtQ29udHJvbCc6ICduby1jYWNoZSwgbm8tc3RvcmUsIG11c3QtcmV2YWxpZGF0ZScsCiAgICAgICAgICAgICAgICAgICAgJ1ByYWdtYSc6ICduby1jYWNoZScsCiAgICAgICAgICAgICAgICAgICAgJ0V4cGlyZXMnOiAnMCcKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEhUVFAgJHtyZXNwb25zZS5zdGF0dXN9OiAke3Jlc3BvbnNlLnN0YXR1c1RleHR9YCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdBY2Nlc3MgY29udHJvbCBkYXRhIGxvYWRlZDonLCBkYXRhKTsKICAgICAgICAgICAgcmV0dXJuIGRhdGE7CiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIGZldGNoIGFjY2VzcyBjb250cm9sOicsIGVycm9yKTsKICAgICAgICAgICAgLy8gSWYgd2UgY2FuJ3QgZmV0Y2ggYWNjZXNzIGNvbnRyb2wsIGFsbG93IGFjY2VzcyAoZmFpbC1vcGVuKQogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgZ2xvYmFsRW5hYmxlZDogdHJ1ZSwKICAgICAgICAgICAgICAgIGFjY2Vzc0NvbnRyb2w6IHsgZW5hYmxlZDogZmFsc2UgfSwKICAgICAgICAgICAgICAgIGZlYXR1cmVzOiB7IGV4dHJhY3Rpb246IHRydWUsIGV4cG9ydDogdHJ1ZSwgZGVidWc6IHRydWUgfQogICAgICAgICAgICB9OwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBjaGVja1VzZXJBY2Nlc3MoYWNjZXNzRGF0YSwgdXNlckZpbmdlcnByaW50KSB7CiAgICAgICAgaWYgKCFhY2Nlc3NEYXRhKSByZXR1cm4gZmFsc2U7CiAgICAgICAgCiAgICAgICAgLy8gQ2hlY2sgaWYgZ2xvYmFsbHkgZGlzYWJsZWQKICAgICAgICBpZiAoIWFjY2Vzc0RhdGEuZ2xvYmFsRW5hYmxlZCkgewogICAgICAgICAgICByZXR1cm4geyBhdXRob3JpemVkOiBmYWxzZSwgcmVhc29uOiAnZGlzYWJsZWQnLCBtZXNzYWdlOiBhY2Nlc3NEYXRhLm1lc3NhZ2U/LmRpc2FibGVkIH07CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIENoZWNrIGlmIGFjY2VzcyBjb250cm9sIGlzIGRpc2FibGVkIChhbGxvdyBhbGwpCiAgICAgICAgaWYgKCFhY2Nlc3NEYXRhLmFjY2Vzc0NvbnRyb2w/LmVuYWJsZWQpIHsKICAgICAgICAgICAgcmV0dXJuIHsgYXV0aG9yaXplZDogdHJ1ZSB9OwogICAgICAgIH0KICAgICAgICAKICAgICAgICBpZiAoIXVzZXJGaW5nZXJwcmludCkgewogICAgICAgICAgICByZXR1cm4geyBhdXRob3JpemVkOiBmYWxzZSwgcmVhc29uOiAnbm9fZmluZ2VycHJpbnQnLCBtZXNzYWdlOiAnRGV2aWNlIGZpbmdlcnByaW50IHJlcXVpcmVkJyB9OwogICAgICAgIH0KICAgICAgICAKICAgICAgICBjb25zdCB7IG1vZGUsIGFsbG93ZWRGaW5nZXJwcmludHMsIGJsb2NrZWRGaW5nZXJwcmludHMgfSA9IGFjY2Vzc0RhdGEuYWNjZXNzQ29udHJvbDsKICAgICAgICAKICAgICAgICAvLyBDaGVjayBibG9ja2VkIGZpbmdlcnByaW50cyBmaXJzdAogICAgICAgIGlmIChibG9ja2VkRmluZ2VycHJpbnRzICYmIGJsb2NrZWRGaW5nZXJwcmludHMuaW5jbHVkZXModXNlckZpbmdlcnByaW50KSkgewogICAgICAgICAgICByZXR1cm4geyBhdXRob3JpemVkOiBmYWxzZSwgcmVhc29uOiAnYmxvY2tlZCcsIG1lc3NhZ2U6IGFjY2Vzc0RhdGEubWVzc2FnZT8udW5hdXRob3JpemVkIH07CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGlmIChtb2RlID09PSAnd2hpdGVsaXN0JykgewogICAgICAgICAgICAvLyBDaGVjayBmaW5nZXJwcmludCBtYXRjaAogICAgICAgICAgICBpZiAoYWxsb3dlZEZpbmdlcnByaW50cyAmJiBhbGxvd2VkRmluZ2VycHJpbnRzLmluY2x1ZGVzKHVzZXJGaW5nZXJwcmludCkpIHsKICAgICAgICAgICAgICAgIHJldHVybiB7IGF1dGhvcml6ZWQ6IHRydWUgfTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIHsgYXV0aG9yaXplZDogZmFsc2UsIHJlYXNvbjogJ25vdF93aGl0ZWxpc3RlZCcsIG1lc3NhZ2U6IGFjY2Vzc0RhdGEubWVzc2FnZT8udW5hdXRob3JpemVkIH07CiAgICAgICAgfSBlbHNlIGlmIChtb2RlID09PSAnYmxhY2tsaXN0JykgewogICAgICAgICAgICAvLyBJbiBibGFja2xpc3QgbW9kZSwgYWxsb3cgZXZlcnlvbmUgZXhjZXB0IGJsb2NrZWQgZmluZ2VycHJpbnRzCiAgICAgICAgICAgIHJldHVybiB7IGF1dGhvcml6ZWQ6IHRydWUgfTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgcmV0dXJuIHsgYXV0aG9yaXplZDogZmFsc2UsIHJlYXNvbjogJ3Vua25vd24nLCBtZXNzYWdlOiBhY2Nlc3NEYXRhLm1lc3NhZ2U/LnVuYXV0aG9yaXplZCB9OwogICAgfQoKICAgIGFzeW5jIGZ1bmN0aW9uIHZlcmlmeUFjY2VzcygpIHsKICAgICAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpOwogICAgICAgIAogICAgICAgIC8vIE9ubHkgY2hlY2sgaWYgaXQncyBiZWVuIG1vcmUgdGhhbiBDSEVDS19JTlRFUlZBTCBzaW5jZSBsYXN0IGNoZWNrCiAgICAgICAgaWYgKGFjY2Vzc0NvbnRyb2xEYXRhICYmIChub3cgLSBsYXN0QWNjZXNzQ2hlY2spIDwgQ0hFQ0tfSU5URVJWQUwpIHsKICAgICAgICAgICAgcmV0dXJuIHsgYXV0aG9yaXplZDogaXNBdXRob3JpemVkLCBkYXRhOiBhY2Nlc3NDb250cm9sRGF0YSB9OwogICAgICAgIH0KICAgICAgICAKICAgICAgICBjb25zb2xlLmxvZygnVmVyaWZ5aW5nIHVzZXIgYWNjZXNzLi4uJyk7CiAgICAgICAgbGFzdEFjY2Vzc0NoZWNrID0gbm93OwogICAgICAgIAogICAgICAgIC8vIEZldGNoIGN1cnJlbnQgYWNjZXNzIGNvbnRyb2wgZGF0YQogICAgICAgIGFjY2Vzc0NvbnRyb2xEYXRhID0gYXdhaXQgZmV0Y2hBY2Nlc3NDb250cm9sKCk7CiAgICAgICAgCiAgICAgICAgLy8gR2V0IHVzZXIgZmluZ2VycHJpbnQKICAgICAgICB1c2VyRmluZ2VycHJpbnQgPSBnZXRVc2VyRmluZ2VycHJpbnQoKTsKICAgICAgICAKICAgICAgICAvLyBDaGVjayBhY2Nlc3MKICAgICAgICBjb25zdCBhY2Nlc3NSZXN1bHQgPSBjaGVja1VzZXJBY2Nlc3MoYWNjZXNzQ29udHJvbERhdGEsIHVzZXJGaW5nZXJwcmludCk7CiAgICAgICAgaXNBdXRob3JpemVkID0gYWNjZXNzUmVzdWx0LmF1dGhvcml6ZWQ7CiAgICAgICAgCiAgICAgICAgY29uc29sZS5sb2coJ0FjY2VzcyB2ZXJpZmljYXRpb24gcmVzdWx0OicsIGFjY2Vzc1Jlc3VsdCk7CiAgICAgICAgY29uc29sZS5sb2coJ1VzZXIgZmluZ2VycHJpbnQ6JywgdXNlckZpbmdlcnByaW50KTsKICAgICAgICAKICAgICAgICByZXR1cm4geyAKICAgICAgICAgICAgYXV0aG9yaXplZDogYWNjZXNzUmVzdWx0LmF1dGhvcml6ZWQsIAogICAgICAgICAgICByZWFzb246IGFjY2Vzc1Jlc3VsdC5yZWFzb24sCiAgICAgICAgICAgIG1lc3NhZ2U6IGFjY2Vzc1Jlc3VsdC5tZXNzYWdlLAogICAgICAgICAgICBkYXRhOiBhY2Nlc3NDb250cm9sRGF0YSAKICAgICAgICB9OwogICAgfQoKICAgIGZ1bmN0aW9uIHNob3dBY2Nlc3NEZW5pZWRNZXNzYWdlKHJlYXNvbiwgbWVzc2FnZSkgewogICAgICAgIGNvbnN0IGRlbmllZERpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgIGRlbmllZERpdi5pZCA9ICdjYXItZXh0cmFjdG9yLWFjY2Vzcy1kZW5pZWQnOwogICAgICAgIGRlbmllZERpdi5pbm5lckhUTUwgPSBgCiAgICAgICAgICAgIDxkaXYgc3R5bGU9InBvc2l0aW9uOiBmaXhlZDsgdG9wOiA1MCU7IGxlZnQ6IDUwJTsgdHJhbnNmb3JtOiB0cmFuc2xhdGUoLTUwJSwgLTUwJSk7IAogICAgICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoMTgwZGVnLCAjZGMzNTQ1IDAlLCAjYzgyMzMzIDEwMCUpOyAKICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6IHdoaXRlOyBwYWRkaW5nOiAyMHB4OyBib3JkZXItcmFkaXVzOiA4cHg7IAogICAgICAgICAgICAgICAgICAgICAgICBib3gtc2hhZG93OiAwIDRweCAyMHB4IHJnYmEoMCwwLDAsMC41KTsgei1pbmRleDogMTAwMDM7IAogICAgICAgICAgICAgICAgICAgICAgICBmb250LWZhbWlseTogJ0NvbnNvbGFzJywgJ01vbmFjbycsICdDb3VyaWVyIE5ldycsIG1vbm9zcGFjZTsKICAgICAgICAgICAgICAgICAgICAgICAgbWF4LXdpZHRoOiA0MDBweDsgdGV4dC1hbGlnbjogY2VudGVyOyI+CiAgICAgICAgICAgICAgICA8aDMgc3R5bGU9Im1hcmdpbjogMCAwIDE1cHggMDsiPvCfmqsgQWNjZXNzIERlbmllZDwvaDM+CiAgICAgICAgICAgICAgICA8cCBzdHlsZT0ibWFyZ2luOiAwIDAgMTVweCAwOyI+JHttZXNzYWdlIHx8ICdZb3UgYXJlIG5vdCBhdXRob3JpemVkIHRvIHVzZSB0aGlzIHRvb2wuJ308L3A+CiAgICAgICAgICAgICAgICA8cCBzdHlsZT0ibWFyZ2luOiAwIDAgMTVweCAwOyBmb250LXNpemU6IDEycHg7IG9wYWNpdHk6IDAuODsiPgogICAgICAgICAgICAgICAgICAgIERldmljZTogJHt1c2VyRmluZ2VycHJpbnQgfHwgJ1Vua25vd24nfTxicj4KICAgICAgICAgICAgICAgICAgICBSZWFzb246ICR7cmVhc29uIHx8ICdVbmtub3duJ30KICAgICAgICAgICAgICAgIDwvcD4KICAgICAgICAgICAgICAgIDxidXR0b24gb25jbGljaz0idGhpcy5wYXJlbnRFbGVtZW50LnBhcmVudEVsZW1lbnQucmVtb3ZlKCkiIAogICAgICAgICAgICAgICAgICAgICAgICBzdHlsZT0iYmFja2dyb3VuZDogcmdiYSgyNTUsMjU1LDI1NSwwLjIpOyBib3JkZXI6IDFweCBzb2xpZCByZ2JhKDI1NSwyNTUsMjU1LDAuMyk7IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6IHdoaXRlOyBwYWRkaW5nOiA4cHggMTZweDsgYm9yZGVyLXJhZGl1czogNHB4OyBjdXJzb3I6IHBvaW50ZXI7Ij4KICAgICAgICAgICAgICAgICAgICBDbG9zZQogICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgIGA7CiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChkZW5pZWREaXYpOwogICAgICAgIAogICAgICAgIC8vIEF1dG8tcmVtb3ZlIGFmdGVyIDEwIHNlY29uZHMKICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgaWYgKGRlbmllZERpdi5wYXJlbnRFbGVtZW50KSB7CiAgICAgICAgICAgICAgICBkZW5pZWREaXYucmVtb3ZlKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9LCAxMDAwMCk7CiAgICB9CgogICAgZnVuY3Rpb24gc2hvd0FjY2Vzc1N0YXR1cygpIHsKICAgICAgICBjb25zdCBzdGF0dXNEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICBzdGF0dXNEaXYuaWQgPSAnY2FyLWV4dHJhY3Rvci1hY2Nlc3Mtc3RhdHVzJzsKICAgICAgICBzdGF0dXNEaXYuaW5uZXJIVE1MID0gYAogICAgICAgICAgICA8ZGl2IHN0eWxlPSJwb3NpdGlvbjogZml4ZWQ7IGJvdHRvbTogMTBweDsgcmlnaHQ6IDEwcHg7IAogICAgICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiByZ2JhKDQwLCAxNjcsIDY5LCAwLjkpOyBjb2xvcjogd2hpdGU7IAogICAgICAgICAgICAgICAgICAgICAgICBwYWRkaW5nOiA4cHggMTJweDsgYm9yZGVyLXJhZGl1czogNHB4OyAKICAgICAgICAgICAgICAgICAgICAgICAgZm9udC1mYW1pbHk6ICdDb25zb2xhcycsICdNb25hY28nLCAnQ291cmllciBOZXcnLCBtb25vc3BhY2U7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvbnQtc2l6ZTogMTFweDsgei1pbmRleDogMTAwMDI7Ij4KICAgICAgICAgICAgICAgIOKchSBBdXRob3JpemVkIERldmljZTogJHt1c2VyRmluZ2VycHJpbnQgPyB1c2VyRmluZ2VycHJpbnQuc3Vic3RyaW5nKDAsIDEyKSArICcuLi4nIDogJ1Vua25vd24nfQogICAgICAgICAgICA8L2Rpdj4KICAgICAgICBgOwogICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoc3RhdHVzRGl2KTsKICAgICAgICAKICAgICAgICAvLyBBdXRvLXJlbW92ZSBhZnRlciAzIHNlY29uZHMKICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgaWYgKHN0YXR1c0Rpdi5wYXJlbnRFbGVtZW50KSB7CiAgICAgICAgICAgICAgICBzdGF0dXNEaXYucmVtb3ZlKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9LCAzMDAwKTsKICAgIH0KCiAgICAgICAgLy8gQ3JlYXRlIGxlZnQgcmliYm9uIFVJCiAgICBmdW5jdGlvbiBjcmVhdGVVSSgpIHsKICAgICAgICBjb25zdCByaWJib24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICByaWJib24uaWQgPSAnY2FyLWV4dHJhY3Rvci1yaWJib24nOwogICAgICAgIHJpYmJvbi5pbm5lckhUTUwgPSBgCiAgICAgICAgICAgIDxkaXYgY2xhc3M9InJpYmJvbi1oZWFkZXIiPgogICAgICAgICAgICAgICAgPHNwYW4+Q0FSIEJBVENIIEVYVFJBQ1RPUiB2MS4wPC9zcGFuPgogICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD0ibWluaW1pemUtcmliYm9uLWJ0biIgdGl0bGU9Ik1pbmltaXplIj4tPC9idXR0b24+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8ZGl2IGlkPSJyaWJib24tY29udGVudCI+CiAgICAgICAgICAgICAgICA8YnV0dG9uIGlkPSJkZWJ1Zy1wYWdlLWJ0biI+ZGVidWc8L2J1dHRvbj4KICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9ImRpc3BsYXk6IGZsZXg7IGdhcDogNXB4OyBtYXJnaW4tYm90dG9tOiAxMHB4OyI+CiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD0ic3RhcnQtZXh0cmFjdGlvbi1idG4iPnN0YXJ0PC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD0icGF1c2UtZXh0cmFjdGlvbi1idG4iIGRpc2FibGVkPnBhdXNlPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD0ic3RvcC1leHRyYWN0aW9uLWJ0biIgZGlzYWJsZWQ+c3RvcDwvYnV0dG9uPgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IGlkPSJwcm9ncmVzcy1pbmZvIj5SZWFkeSB0byBleHRyYWN0IENBUiBkYXRhPC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IGlkPSJzdGF0dXMtaW5mbyI+V2FpdGluZyBmb3IgaW5wdXQuLi48L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9ImRpc3BsYXk6IGZsZXg7IGdhcDogNXB4OyBtYXJnaW4tYm90dG9tOiAxMHB4OyI+CiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD0iZXhwb3J0LXJlc3VsdHMtYnRuIiBkaXNhYmxlZD5leHBvcnQ8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGlkPSJjbGVhci1yZXN1bHRzLWJ0biI+Y2xlYXI8L2J1dHRvbj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBpZD0iY2FyLXJlc3VsdHMiPjwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICBgOwogICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQocmliYm9uKTsKICAgICAgICAKICAgICAgICAvLyBDcmVhdGUgbWluaW1pemVkIHN0YXRlIGJ1dHRvbgogICAgICAgIGNvbnN0IG1pbmltaXplZEJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgIG1pbmltaXplZEJ0bi5pZCA9ICdyaWJib24tbWluaW1pemVkLWJ0bic7CiAgICAgICAgbWluaW1pemVkQnRuLmlubmVySFRNTCA9ICfwn5OLJzsKICAgICAgICBtaW5pbWl6ZWRCdG4udGl0bGUgPSAnU2hvdyBDQVIgRXh0cmFjdG9yJzsKICAgICAgICBtaW5pbWl6ZWRCdG4uc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKG1pbmltaXplZEJ0bik7CiAgICAgICAgCiAgICAgICAgLy8gQWRkIGV2ZW50IGxpc3RlbmVycwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkZWJ1Zy1wYWdlLWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZGVidWdQYWdlKTsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3RhcnQtZXh0cmFjdGlvbi1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHN0YXJ0RXh0cmFjdGlvbik7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BhdXNlLWV4dHJhY3Rpb24tYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBwYXVzZUV4dHJhY3Rpb24pOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdG9wLWV4dHJhY3Rpb24tYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBzdG9wRXh0cmFjdGlvbik7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2V4cG9ydC1yZXN1bHRzLWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZXhwb3J0UmVzdWx0cyk7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NsZWFyLXJlc3VsdHMtYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBjbGVhclJlc3VsdHMpOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtaW5pbWl6ZS1yaWJib24tYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBtaW5pbWl6ZVJpYmJvbik7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JpYmJvbi1taW5pbWl6ZWQtYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBtYXhpbWl6ZVJpYmJvbik7CiAgICAgICAgCiAgICAgICAgLy8gQ3JlYXRlIGNvbnRleHQgbWVudSBmb3IgaW5kaXZpZHVhbCBDQVIgcmVmcmVzaAogICAgICAgIGNyZWF0ZUNvbnRleHRNZW51KCk7CiAgICB9CgogICAgLy8gQWRkIENTUyBmb3IgdGhlIHJpYmJvbgogICAgR01fYWRkU3R5bGUoYAogICAgICAgICNjYXItZXh0cmFjdG9yLXJpYmJvbiB7CiAgICAgICAgICAgIHBvc2l0aW9uOiBmaXhlZDsKICAgICAgICAgICAgbGVmdDogMDsKICAgICAgICAgICAgdG9wOiAwOwogICAgICAgICAgICB3aWR0aDogMzIwcHg7CiAgICAgICAgICAgIGhlaWdodDogMTAwdmg7CiAgICAgICAgICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCgxODBkZWcsICMwZDExMTcgMCUsICMxNjFiMjIgNTAlLCAjMWMyMTI4IDEwMCUpOwogICAgICAgICAgICBjb2xvcjogI2M5ZDFkOTsKICAgICAgICAgICAgei1pbmRleDogMTAwMDA7CiAgICAgICAgICAgIGJveC1zaGFkb3c6IDJweCAwIDEwcHggcmdiYSgwLCAwLCAwLCAwLjYpOwogICAgICAgICAgICBmb250LWZhbWlseTogJ0NvbnNvbGFzJywgJ01vbmFjbycsICdDb3VyaWVyIE5ldycsIG1vbm9zcGFjZTsKICAgICAgICAgICAgb3ZlcmZsb3cteTogYXV0bzsKICAgICAgICAgICAgcGFkZGluZzogMTVweDsKICAgICAgICAgICAgYm9yZGVyLXJpZ2h0OiAxcHggc29saWQgIzMwMzYzZDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgI2Nhci1leHRyYWN0b3ItcmliYm9uIGJ1dHRvbiB7CiAgICAgICAgICAgIGZvbnQtZmFtaWx5OiAnQ29uc29sYXMnLCAnTW9uYWNvJywgJ0NvdXJpZXIgTmV3JywgbW9ub3NwYWNlOwogICAgICAgICAgICBmb250LXNpemU6IDExcHg7CiAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiA1MDA7CiAgICAgICAgICAgIGxldHRlci1zcGFjaW5nOiAwLjVweDsKICAgICAgICAgICAgdHJhbnNpdGlvbjogYWxsIDAuMnMgZWFzZTsKICAgICAgICAgICAgYm9yZGVyOiAxcHggc29saWQgcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjEpOwogICAgICAgICAgICBiYWNrZHJvcC1maWx0ZXI6IGJsdXIoNXB4KTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgI2Nhci1leHRyYWN0b3ItcmliYm9uIGJ1dHRvbjpob3ZlciB7CiAgICAgICAgICAgIGJvcmRlci1jb2xvcjogcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjIpOwogICAgICAgICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoLTFweCk7CiAgICAgICAgICAgIGJveC1zaGFkb3c6IDAgMnB4IDhweCByZ2JhKDAsIDAsIDAsIDAuMyk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgICNkZWJ1Zy1wYWdlLWJ0biB7CiAgICAgICAgICAgIGJhY2tncm91bmQ6IHJnYmEoMzMsIDEzNiwgMjA5LCAwLjE1KSAhaW1wb3J0YW50OwogICAgICAgICAgICBjb2xvcjogIzU4YTZmZiAhaW1wb3J0YW50OwogICAgICAgIH0KICAgICAgICAKICAgICAgICAjZGVidWctcGFnZS1idG46aG92ZXIgewogICAgICAgICAgICBiYWNrZ3JvdW5kOiByZ2JhKDMzLCAxMzYsIDIwOSwgMC4yNSkgIWltcG9ydGFudDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgI3N0YXJ0LWV4dHJhY3Rpb24tYnRuIHsKICAgICAgICAgICAgYmFja2dyb3VuZDogcmdiYSg0NiwgMTYwLCA2NywgMC4xNSkgIWltcG9ydGFudDsKICAgICAgICAgICAgY29sb3I6ICM1NmQzNjQgIWltcG9ydGFudDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgI3N0YXJ0LWV4dHJhY3Rpb24tYnRuOmhvdmVyIHsKICAgICAgICAgICAgYmFja2dyb3VuZDogcmdiYSg0NiwgMTYwLCA2NywgMC4yNSkgIWltcG9ydGFudDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgI3BhdXNlLWV4dHJhY3Rpb24tYnRuIHsKICAgICAgICAgICAgYmFja2dyb3VuZDogcmdiYSgxODcsIDEyOCwgOSwgMC4xNSkgIWltcG9ydGFudDsKICAgICAgICAgICAgY29sb3I6ICNlM2IzNDEgIWltcG9ydGFudDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgI3BhdXNlLWV4dHJhY3Rpb24tYnRuOmhvdmVyIHsKICAgICAgICAgICAgYmFja2dyb3VuZDogcmdiYSgxODcsIDEyOCwgOSwgMC4yNSkgIWltcG9ydGFudDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgI3N0b3AtZXh0cmFjdGlvbi1idG4gewogICAgICAgICAgICBiYWNrZ3JvdW5kOiByZ2JhKDIxOCwgNTQsIDUxLCAwLjE1KSAhaW1wb3J0YW50OwogICAgICAgICAgICBjb2xvcjogI2Y4NTE0OSAhaW1wb3J0YW50OwogICAgICAgIH0KICAgICAgICAKICAgICAgICAjc3RvcC1leHRyYWN0aW9uLWJ0bjpob3ZlciB7CiAgICAgICAgICAgIGJhY2tncm91bmQ6IHJnYmEoMjE4LCA1NCwgNTEsIDAuMjUpICFpbXBvcnRhbnQ7CiAgICAgICAgfQogICAgICAgIAogICAgICAgICNleHBvcnQtcmVzdWx0cy1idG4gewogICAgICAgICAgICBiYWNrZ3JvdW5kOiByZ2JhKDEwMiwgMTE3LCAxMjcsIDAuMTUpICFpbXBvcnRhbnQ7CiAgICAgICAgICAgIGNvbG9yOiAjOGI5NDllICFpbXBvcnRhbnQ7CiAgICAgICAgfQogICAgICAgIAogICAgICAgICNleHBvcnQtcmVzdWx0cy1idG46aG92ZXIgewogICAgICAgICAgICBiYWNrZ3JvdW5kOiByZ2JhKDEwMiwgMTE3LCAxMjcsIDAuMjUpICFpbXBvcnRhbnQ7CiAgICAgICAgfQogICAgICAgIAogICAgICAgICNjbGVhci1yZXN1bHRzLWJ0biB7CiAgICAgICAgICAgIGJhY2tncm91bmQ6IHJnYmEoMjQwLCAxMjYsIDM3LCAwLjE1KSAhaW1wb3J0YW50OwogICAgICAgICAgICBjb2xvcjogI2ZmOGM0MiAhaW1wb3J0YW50OwogICAgICAgIH0KICAgICAgICAKICAgICAgICAjY2xlYXItcmVzdWx0cy1idG46aG92ZXIgewogICAgICAgICAgICBiYWNrZ3JvdW5kOiByZ2JhKDI0MCwgMTI2LCAzNywgMC4yNSkgIWltcG9ydGFudDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLmNhci1lbnRyeSB7CiAgICAgICAgICAgIGJhY2tncm91bmQ6IHJnYmEoMjIsIDI3LCAzNCwgMC42KTsKICAgICAgICAgICAgbWFyZ2luLWJvdHRvbTogNnB4OwogICAgICAgICAgICBwYWRkaW5nOiA4cHg7CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDRweDsKICAgICAgICAgICAgYm9yZGVyLWxlZnQ6IDJweCBzb2xpZCAjMjEyNjJkOwogICAgICAgICAgICBmb250LXNpemU6IDExcHg7CiAgICAgICAgICAgIGxpbmUtaGVpZ2h0OiAxLjQ7CiAgICAgICAgICAgIGJvcmRlcjogMXB4IHNvbGlkIHJnYmEoNDgsIDU0LCA2MSwgMC41KTsKICAgICAgICAgICAgYmFja2Ryb3AtZmlsdGVyOiBibHVyKDNweCk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC5jYXItZW50cnkubG9hZGluZyB7CiAgICAgICAgICAgIGJvcmRlci1sZWZ0LWNvbG9yOiAjZTNiMzQxOwogICAgICAgICAgICBiYWNrZ3JvdW5kOiByZ2JhKDE4NywgMTI4LCA5LCAwLjEpOwogICAgICAgICAgICBib3JkZXItY29sb3I6IHJnYmEoMTg3LCAxMjgsIDksIDAuMyk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC5jYXItZW50cnkuZXJyb3IgewogICAgICAgICAgICBib3JkZXItbGVmdC1jb2xvcjogI2Y4NTE0OTsKICAgICAgICAgICAgYmFja2dyb3VuZDogcmdiYSgyMTgsIDU0LCA1MSwgMC4xKTsKICAgICAgICAgICAgYm9yZGVyLWNvbG9yOiByZ2JhKDIxOCwgNTQsIDUxLCAwLjMpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAuY2FyLWVudHJ5OmhvdmVyIHsKICAgICAgICAgICAgYmFja2dyb3VuZDogcmdiYSgyMiwgMjcsIDM0LCAwLjgpOwogICAgICAgICAgICBib3JkZXItY29sb3I6IHJnYmEoNDgsIDU0LCA2MSwgMC44KTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLmNhci1pZCB7CiAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiBib2xkOwogICAgICAgICAgICBmb250LXNpemU6IDEycHg7CiAgICAgICAgICAgIG1hcmdpbi1ib3R0b206IDRweDsKICAgICAgICAgICAgY29sb3I6ICM1OGE2ZmY7CiAgICAgICAgICAgIGZvbnQtZmFtaWx5OiAnQ29uc29sYXMnLCAnTW9uYWNvJywgJ0NvdXJpZXIgTmV3JywgbW9ub3NwYWNlOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAuY2FyLWRldGFpbHMgewogICAgICAgICAgICBjb2xvcjogIzhiOTQ5ZTsKICAgICAgICAgICAgZm9udC1mYW1pbHk6ICdDb25zb2xhcycsICdNb25hY28nLCAnQ291cmllciBOZXcnLCBtb25vc3BhY2U7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC5jYXItZGV0YWlscyBkaXYgewogICAgICAgICAgICBtYXJnaW4tYm90dG9tOiAxcHg7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC5jYXItZGV0YWlscyBzdHJvbmcgewogICAgICAgICAgICBjb2xvcjogI2M5ZDFkOTsKICAgICAgICAgICAgZm9udC13ZWlnaHQ6IDUwMDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgI3Byb2dyZXNzLWluZm8gewogICAgICAgICAgICBmb250LXNpemU6IDExcHg7CiAgICAgICAgICAgIGNvbG9yOiAjN2Q4NTkwOwogICAgICAgICAgICBtaW4taGVpZ2h0OiAxNHB4OwogICAgICAgICAgICBmb250LWZhbWlseTogJ0NvbnNvbGFzJywgJ01vbmFjbycsICdDb3VyaWVyIE5ldycsIG1vbm9zcGFjZTsKICAgICAgICAgICAgYmFja2dyb3VuZDogcmdiYSgxMywgMTcsIDIzLCAwLjUpOwogICAgICAgICAgICBwYWRkaW5nOiA0cHggOHB4OwogICAgICAgICAgICBib3JkZXItcmFkaXVzOiAzcHg7CiAgICAgICAgICAgIGJvcmRlcjogMXB4IHNvbGlkIHJnYmEoNDgsIDU0LCA2MSwgMC4zKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgI3N0YXR1cy1pbmZvIHsKICAgICAgICAgICAgZm9udC1zaXplOiAxMHB4OwogICAgICAgICAgICBjb2xvcjogIzY1NmQ3NjsKICAgICAgICAgICAgbWluLWhlaWdodDogMTJweDsKICAgICAgICAgICAgZm9udC1mYW1pbHk6ICdDb25zb2xhcycsICdNb25hY28nLCAnQ291cmllciBOZXcnLCBtb25vc3BhY2U7CiAgICAgICAgICAgIGJhY2tncm91bmQ6IHJnYmEoMTMsIDE3LCAyMywgMC4zKTsKICAgICAgICAgICAgcGFkZGluZzogM3B4IDZweDsKICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogM3B4OwogICAgICAgICAgICBmb250LXN0eWxlOiBpdGFsaWM7CiAgICAgICAgfQogICAgICAgIAogICAgICAgICNjYXItcmVzdWx0cyB7CiAgICAgICAgICAgIG1hcmdpbi10b3A6IDEwcHg7CiAgICAgICAgICAgIG1heC1oZWlnaHQ6IDYwdmg7CiAgICAgICAgICAgIG92ZXJmbG93LXk6IGF1dG87CiAgICAgICAgfQogICAgICAgIAogICAgICAgICNjYXItcmVzdWx0czo6LXdlYmtpdC1zY3JvbGxiYXIgewogICAgICAgICAgICB3aWR0aDogNnB4OwogICAgICAgIH0KICAgICAgICAKICAgICAgICAjY2FyLXJlc3VsdHM6Oi13ZWJraXQtc2Nyb2xsYmFyLXRyYWNrIHsKICAgICAgICAgICAgYmFja2dyb3VuZDogcmdiYSgxMywgMTcsIDIzLCAwLjMpOwogICAgICAgICAgICBib3JkZXItcmFkaXVzOiAzcHg7CiAgICAgICAgfQogICAgICAgIAogICAgICAgICNjYXItcmVzdWx0czo6LXdlYmtpdC1zY3JvbGxiYXItdGh1bWIgewogICAgICAgICAgICBiYWNrZ3JvdW5kOiByZ2JhKDQ4LCA1NCwgNjEsIDAuNik7CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDNweDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgI2Nhci1yZXN1bHRzOjotd2Via2l0LXNjcm9sbGJhci10aHVtYjpob3ZlciB7CiAgICAgICAgICAgIGJhY2tncm91bmQ6IHJnYmEoNDgsIDU0LCA2MSwgMC44KTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLyogQWRqdXN0IG1haW4gY29udGVudCB0byBtYWtlIHNwYWNlIGZvciByaWJib24gKi8KICAgICAgICBib2R5IHsKICAgICAgICAgICAgbWFyZ2luLWxlZnQ6IDMyMHB4ICFpbXBvcnRhbnQ7CiAgICAgICAgICAgIHRyYW5zaXRpb246IG1hcmdpbi1sZWZ0IDAuM3MgZWFzZSAhaW1wb3J0YW50OwogICAgICAgIH0KICAgICAgICAKICAgICAgICBib2R5LnJpYmJvbi1taW5pbWl6ZWQgewogICAgICAgICAgICBtYXJnaW4tbGVmdDogMHB4ICFpbXBvcnRhbnQ7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8qIEFkZCBzb21lIHRlcm1pbmFsLWxpa2Ugc3R5bGluZyAqLwogICAgICAgIC5yaWJib24taGVhZGVyIHsKICAgICAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICAgICAganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuOwogICAgICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICAgICAgICBjb2xvcjogIzU4YTZmZjsKICAgICAgICAgICAgZm9udC13ZWlnaHQ6IDYwMDsKICAgICAgICAgICAgdGV4dC1zaGFkb3c6IDAgMCA1cHggcmdiYSg4OCwgMTY2LCAyNTUsIDAuMyk7CiAgICAgICAgICAgIG1hcmdpbi1ib3R0b206IDE1cHg7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMTRweDsKICAgICAgICAgICAgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkIHJnYmEoNDgsIDU0LCA2MSwgMC41KTsKICAgICAgICAgICAgcGFkZGluZy1ib3R0b206IDhweDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgI21pbmltaXplLXJpYmJvbi1idG4gewogICAgICAgICAgICBiYWNrZ3JvdW5kOiByZ2JhKDg4LCAxNjYsIDI1NSwgMC4xNSkgIWltcG9ydGFudDsKICAgICAgICAgICAgY29sb3I6ICM1OGE2ZmYgIWltcG9ydGFudDsKICAgICAgICAgICAgYm9yZGVyOiAxcHggc29saWQgcmdiYSg4OCwgMTY2LCAyNTUsIDAuMykgIWltcG9ydGFudDsKICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogM3B4ICFpbXBvcnRhbnQ7CiAgICAgICAgICAgIHBhZGRpbmc6IDJweCA4cHggIWltcG9ydGFudDsKICAgICAgICAgICAgZm9udC1zaXplOiAxMnB4ICFpbXBvcnRhbnQ7CiAgICAgICAgICAgIGN1cnNvcjogcG9pbnRlciAhaW1wb3J0YW50OwogICAgICAgICAgICB0cmFuc2l0aW9uOiBhbGwgMC4ycyBlYXNlICFpbXBvcnRhbnQ7CiAgICAgICAgfQogICAgICAgIAogICAgICAgICNtaW5pbWl6ZS1yaWJib24tYnRuOmhvdmVyIHsKICAgICAgICAgICAgYmFja2dyb3VuZDogcmdiYSg4OCwgMTY2LCAyNTUsIDAuMjUpICFpbXBvcnRhbnQ7CiAgICAgICAgICAgIHRyYW5zZm9ybTogc2NhbGUoMS4wNSkgIWltcG9ydGFudDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgI3JpYmJvbi1taW5pbWl6ZWQtYnRuIHsKICAgICAgICAgICAgcG9zaXRpb246IGZpeGVkOwogICAgICAgICAgICBsZWZ0OiAxMHB4OwogICAgICAgICAgICB0b3A6IDEwcHg7CiAgICAgICAgICAgIHdpZHRoOiA0MHB4OwogICAgICAgICAgICBoZWlnaHQ6IDQwcHg7CiAgICAgICAgICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCgxMzVkZWcsICMwZDExMTcgMCUsICMxNjFiMjIgMTAwJSk7CiAgICAgICAgICAgIGJvcmRlcjogMnB4IHNvbGlkICMzMDM2M2Q7CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDhweDsKICAgICAgICAgICAgY29sb3I6ICM1OGE2ZmY7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMThweDsKICAgICAgICAgICAgY3Vyc29yOiBwb2ludGVyOwogICAgICAgICAgICB6LWluZGV4OiAxMDAwMTsKICAgICAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgICAgICAgICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7CiAgICAgICAgICAgIGJveC1zaGFkb3c6IDJweCAycHggMTBweCByZ2JhKDAsIDAsIDAsIDAuNik7CiAgICAgICAgICAgIHRyYW5zaXRpb246IGFsbCAwLjJzIGVhc2U7CiAgICAgICAgfQogICAgICAgIAogICAgICAgICNyaWJib24tbWluaW1pemVkLWJ0bjpob3ZlciB7CiAgICAgICAgICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCgxMzVkZWcsICMxNjFiMjIgMCUsICMxYzIxMjggMTAwJSk7CiAgICAgICAgICAgIGJvcmRlci1jb2xvcjogIzU4YTZmZjsKICAgICAgICAgICAgdHJhbnNmb3JtOiBzY2FsZSgxLjEpOwogICAgICAgICAgICBib3gtc2hhZG93OiAwIDAgMTVweCByZ2JhKDg4LCAxNjYsIDI1NSwgMC40KTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLmNhci1jb250ZXh0LW1lbnUgewogICAgICAgICAgICBwb3NpdGlvbjogZml4ZWQ7CiAgICAgICAgICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCgxODBkZWcsICMxNjFiMjIgMCUsICMxYzIxMjggMTAwJSk7CiAgICAgICAgICAgIGJvcmRlcjogMXB4IHNvbGlkICMzMDM2M2Q7CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDZweDsKICAgICAgICAgICAgcGFkZGluZzogNHB4IDA7CiAgICAgICAgICAgIHotaW5kZXg6IDEwMDAyOwogICAgICAgICAgICBib3gtc2hhZG93OiAwIDRweCAxMnB4IHJnYmEoMCwgMCwgMCwgMC43KTsKICAgICAgICAgICAgZm9udC1mYW1pbHk6ICdDb25zb2xhcycsICdNb25hY28nLCAnQ291cmllciBOZXcnLCBtb25vc3BhY2U7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMTFweDsKICAgICAgICAgICAgbWluLXdpZHRoOiAxMjBweDsKICAgICAgICAgICAgZGlzcGxheTogbm9uZTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLmNhci1jb250ZXh0LW1lbnUtaXRlbSB7CiAgICAgICAgICAgIHBhZGRpbmc6IDZweCAxMnB4OwogICAgICAgICAgICBjb2xvcjogI2M5ZDFkOTsKICAgICAgICAgICAgY3Vyc29yOiBwb2ludGVyOwogICAgICAgICAgICB0cmFuc2l0aW9uOiBiYWNrZ3JvdW5kIDAuMnMgZWFzZTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLmNhci1jb250ZXh0LW1lbnUtaXRlbTpob3ZlciB7CiAgICAgICAgICAgIGJhY2tncm91bmQ6IHJnYmEoODgsIDE2NiwgMjU1LCAwLjE1KTsKICAgICAgICAgICAgY29sb3I6ICM1OGE2ZmY7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC5jYXItY29udGV4dC1tZW51LWl0ZW06YWN0aXZlIHsKICAgICAgICAgICAgYmFja2dyb3VuZDogcmdiYSg4OCwgMTY2LCAyNTUsIDAuMjUpOwogICAgICAgIH0KICAgIGApOwoKICAgIGxldCBleHRyYWN0aW9uSW5Qcm9ncmVzcyA9IGZhbHNlOwogICAgbGV0IHNob3VsZFN0b3AgPSBmYWxzZTsKICAgIGxldCBpc1BhdXNlZCA9IGZhbHNlOwogICAgbGV0IGV4dHJhY3RlZERhdGEgPSBbXTsKICAgIGxldCBjdXJyZW50Q2FySW5kZXggPSAwOwogICAgbGV0IGNhckxpbmtzID0gW107CiAgICBsZXQgc2VsZWN0ZWRDYXJJZCA9IG51bGw7CgogICAgLy8gRnVuY3Rpb24gdG8gbWluaW1pemUgdGhlIHJpYmJvbgogICAgZnVuY3Rpb24gbWluaW1pemVSaWJib24oKSB7CiAgICAgICAgY29uc3QgcmliYm9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Nhci1leHRyYWN0b3ItcmliYm9uJyk7CiAgICAgICAgY29uc3QgbWluaW1pemVkQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JpYmJvbi1taW5pbWl6ZWQtYnRuJyk7CiAgICAgICAgY29uc3QgYm9keSA9IGRvY3VtZW50LmJvZHk7CiAgICAgICAgCiAgICAgICAgaWYgKHJpYmJvbiAmJiBtaW5pbWl6ZWRCdG4pIHsKICAgICAgICAgICAgcmliYm9uLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgICAgIG1pbmltaXplZEJ0bi5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnOwogICAgICAgICAgICBib2R5LmNsYXNzTGlzdC5hZGQoJ3JpYmJvbi1taW5pbWl6ZWQnKTsKICAgICAgICB9CiAgICB9CgogICAgLy8gRnVuY3Rpb24gdG8gbWF4aW1pemUgdGhlIHJpYmJvbgogICAgZnVuY3Rpb24gbWF4aW1pemVSaWJib24oKSB7CiAgICAgICAgY29uc3QgcmliYm9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Nhci1leHRyYWN0b3ItcmliYm9uJyk7CiAgICAgICAgY29uc3QgbWluaW1pemVkQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JpYmJvbi1taW5pbWl6ZWQtYnRuJyk7CiAgICAgICAgY29uc3QgYm9keSA9IGRvY3VtZW50LmJvZHk7CiAgICAgICAgCiAgICAgICAgaWYgKHJpYmJvbiAmJiBtaW5pbWl6ZWRCdG4pIHsKICAgICAgICAgICAgcmliYm9uLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgICAgICAgICBtaW5pbWl6ZWRCdG4uc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICAgICAgYm9keS5jbGFzc0xpc3QucmVtb3ZlKCdyaWJib24tbWluaW1pemVkJyk7CiAgICAgICAgfQogICAgfQoKICAgIC8vIEZ1bmN0aW9uIHRvIGNyZWF0ZSBjb250ZXh0IG1lbnUgZm9yIGluZGl2aWR1YWwgQ0FSIHJlZnJlc2gKICAgIGZ1bmN0aW9uIGNyZWF0ZUNvbnRleHRNZW51KCkgewogICAgICAgIGNvbnN0IGNvbnRleHRNZW51ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgY29udGV4dE1lbnUuaWQgPSAnY2FyLWNvbnRleHQtbWVudSc7CiAgICAgICAgY29udGV4dE1lbnUuY2xhc3NOYW1lID0gJ2Nhci1jb250ZXh0LW1lbnUnOwogICAgICAgIGNvbnRleHRNZW51LmlubmVySFRNTCA9IGAKICAgICAgICAgICAgPGRpdiBjbGFzcz0iY2FyLWNvbnRleHQtbWVudS1pdGVtIiBpZD0icmVmcmVzaC1jYXItaXRlbSI+8J+UhCBSZWZyZXNoIENBUjwvZGl2PgogICAgICAgIGA7CiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChjb250ZXh0TWVudSk7CiAgICAgICAgCiAgICAgICAgLy8gQWRkIGNsaWNrIGxpc3RlbmVyIGZvciByZWZyZXNoIGFjdGlvbgogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZWZyZXNoLWNhci1pdGVtJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCByZWZyZXNoU2VsZWN0ZWRDYXIpOwogICAgICAgIAogICAgICAgIC8vIEhpZGUgY29udGV4dCBtZW51IHdoZW4gY2xpY2tpbmcgZWxzZXdoZXJlCiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4gewogICAgICAgICAgICBpZiAoIWUudGFyZ2V0LmNsb3Nlc3QoJy5jYXItY29udGV4dC1tZW51JykpIHsKICAgICAgICAgICAgICAgIGNvbnRleHRNZW51LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICAKICAgICAgICAvLyBQcmV2ZW50IGRlZmF1bHQgY29udGV4dCBtZW51IG9uIHRoZSByaWJib24KICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdjb250ZXh0bWVudScsIChlKSA9PiB7CiAgICAgICAgICAgIGlmIChlLnRhcmdldC5jbG9zZXN0KCcjY2FyLWV4dHJhY3Rvci1yaWJib24nKSkgewogICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9CgogICAgLy8gRnVuY3Rpb24gdG8gc2hvdyBjb250ZXh0IG1lbnUgZm9yIGEgQ0FSIGVudHJ5CiAgICBmdW5jdGlvbiBzaG93Q29udGV4dE1lbnUoZXZlbnQsIGNhcklkKSB7CiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAKICAgICAgICBzZWxlY3RlZENhcklkID0gY2FySWQ7CiAgICAgICAgY29uc3QgY29udGV4dE1lbnUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2FyLWNvbnRleHQtbWVudScpOwogICAgICAgIAogICAgICAgIGlmIChjb250ZXh0TWVudSkgewogICAgICAgICAgICBjb250ZXh0TWVudS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgICAgICAgICAgY29udGV4dE1lbnUuc3R5bGUubGVmdCA9IGV2ZW50LnBhZ2VYICsgJ3B4JzsKICAgICAgICAgICAgY29udGV4dE1lbnUuc3R5bGUudG9wID0gZXZlbnQucGFnZVkgKyAncHgnOwogICAgICAgIH0KICAgIH0KCiAgICAvLyBGdW5jdGlvbiB0byByZWZyZXNoIGEgc3BlY2lmaWMgQ0FSCiAgICBhc3luYyBmdW5jdGlvbiByZWZyZXNoU2VsZWN0ZWRDYXIoKSB7CiAgICAgICAgaWYgKCFzZWxlY3RlZENhcklkKSByZXR1cm47CiAgICAgICAgCiAgICAgICAgY29uc3QgY29udGV4dE1lbnUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2FyLWNvbnRleHQtbWVudScpOwogICAgICAgIGlmIChjb250ZXh0TWVudSkgewogICAgICAgICAgICBjb250ZXh0TWVudS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBjb25zb2xlLmxvZyhg8J+UhCBSZWZyZXNoaW5nIENBUjogJHtzZWxlY3RlZENhcklkfWApOwogICAgICAgIHVwZGF0ZVN0YXR1cyhgUmVmcmVzaGluZyAke3NlbGVjdGVkQ2FySWR9Li4uYCk7CiAgICAgICAgCiAgICAgICAgLy8gRmluZCB0aGUgQ0FSIGxpbmsgZnJvbSBvdXIgc3RvcmVkIGxpbmtzCiAgICAgICAgY29uc3QgY2FyTGluayA9IGNhckxpbmtzLmZpbmQobGluayA9PiBsaW5rLmNhcklkID09PSBzZWxlY3RlZENhcklkKTsKICAgICAgICBpZiAoIWNhckxpbmspIHsKICAgICAgICAgICAgY29uc29sZS5lcnJvcihgQ0FSIGxpbmsgbm90IGZvdW5kIGZvciAke3NlbGVjdGVkQ2FySWR9YCk7CiAgICAgICAgICAgIHVwZGF0ZVN0YXR1cyhg4p2MIENvdWxkIG5vdCBmaW5kIGxpbmsgZm9yICR7c2VsZWN0ZWRDYXJJZH1gKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBVcGRhdGUgdGhlIGVudHJ5IHRvIHNob3cgbG9hZGluZyBzdGF0ZQogICAgICAgIGNvbnN0IGVudHJ5RGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYGNhci1lbnRyeS0ke3NlbGVjdGVkQ2FySWR9YCk7CiAgICAgICAgaWYgKGVudHJ5RGl2KSB7CiAgICAgICAgICAgIGVudHJ5RGl2LmNsYXNzTmFtZSA9ICdjYXItZW50cnkgbG9hZGluZyc7CiAgICAgICAgICAgIGVudHJ5RGl2LmlubmVySFRNTCA9IGAKICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNhci1pZCI+JHtzZWxlY3RlZENhcklkfTwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY2FyLWRldGFpbHMiPlJlZnJlc2hpbmcuLi48L2Rpdj4KICAgICAgICAgICAgYDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gUHJvY2VzcyB0aGUgc2luZ2xlIENBUgogICAgICAgICAgICBhd2FpdCBwcm9jZXNzQ2FyTGluayhjYXJMaW5rLCAwLCAxLCB0cnVlKTsgLy8gUGFzcyB0cnVlIGZvciByZWZyZXNoIG1vZGUKICAgICAgICAgICAgdXBkYXRlU3RhdHVzKGDinIUgUmVmcmVzaGVkICR7c2VsZWN0ZWRDYXJJZH1gKTsKICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciByZWZyZXNoaW5nIENBUjonLCBlcnJvcik7CiAgICAgICAgICAgIHVwZGF0ZVN0YXR1cyhg4p2MIEZhaWxlZCB0byByZWZyZXNoICR7c2VsZWN0ZWRDYXJJZH1gKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFVwZGF0ZSBlbnRyeSB3aXRoIGVycm9yCiAgICAgICAgICAgIGlmIChlbnRyeURpdikgewogICAgICAgICAgICAgICAgZW50cnlEaXYuY2xhc3NOYW1lID0gJ2Nhci1lbnRyeSBlcnJvcic7CiAgICAgICAgICAgICAgICBlbnRyeURpdi5pbm5lckhUTUwgPSBgCiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY2FyLWlkIj4ke3NlbGVjdGVkQ2FySWR9PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY2FyLWRldGFpbHMiIHN0eWxlPSJjb2xvcjogI2ZjYTVhNTsiPkVycm9yOiBGYWlsZWQgdG8gcmVmcmVzaDwvZGl2PgogICAgICAgICAgICAgICAgYDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAKICAgICAgICBzZWxlY3RlZENhcklkID0gbnVsbDsKICAgIH0KCiAgICAvLyBIZWxwZXIgZnVuY3Rpb24gdG8gZm9ybWF0IHRvZGF5J3MgZGF0ZSBmb3IgcmVtYXJrcwogICAgZnVuY3Rpb24gZm9ybWF0VG9kYXlGb3JSZW1hcmtzKCkgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGNvbnN0IHRvZGF5ID0gbmV3IERhdGUoKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEZvcm1hdCBhcyAiREQgTU1NIiAoZS5nLiwgIjAyIFNlcCIpCiAgICAgICAgICAgIGNvbnN0IGRheSA9IHRvZGF5LmdldERhdGUoKS50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJyk7CiAgICAgICAgICAgIGNvbnN0IG1vbnRocyA9IFsnSmFuJywgJ0ZlYicsICdNYXInLCAnQXByJywgJ01heScsICdKdW4nLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0p1bCcsICdBdWcnLCAnU2VwJywgJ09jdCcsICdOb3YnLCAnRGVjJ107CiAgICAgICAgICAgIGNvbnN0IG1vbnRoID0gbW9udGhzW3RvZGF5LmdldE1vbnRoKCldOwogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIGAke2RheX0gJHttb250aH1gOwogICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdFcnJvciBmb3JtYXR0aW5nIHRvZGF5XCdzIGRhdGU6JywgZXJyb3IpOwogICAgICAgICAgICByZXR1cm4gJ1RvZGF5JzsgLy8gRmFsbGJhY2sKICAgICAgICB9CiAgICB9CgogICAgLy8gRnVuY3Rpb24gdG8gZmluZCBhbGwgQ0FSIGxpbmtzIG9uIHRoZSBjdXJyZW50IHBhZ2UKICAgIGZ1bmN0aW9uIGZpbmRDYXJMaW5rcygpIHsKICAgICAgICBjb25zb2xlLmxvZygnU3RhcnRpbmcgdG8gZmluZCBDQVIgbGlua3MuLi4nKTsKICAgICAgICAKICAgICAgICAvLyBMb29rIGZvciBDQVIgbnVtYmVyIGxpbmtzIGluIHRoZSB0YWJsZQogICAgICAgIGNvbnN0IGxpbmtzID0gW107CiAgICAgICAgCiAgICAgICAgLy8gTWV0aG9kIDE6IEZpbmQgQ0FSIG51bWJlciBsaW5rcyBkaXJlY3RseQogICAgICAgIGNvbnNvbGUubG9nKCdNZXRob2QgMTogTG9va2luZyBmb3IgQ0FSIG51bWJlciBsaW5rcy4uLicpOwogICAgICAgIGNvbnN0IGNhckxpbmtzID0gQXJyYXkuZnJvbShkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdhJykpCiAgICAgICAgICAgIC5maWx0ZXIobGluayA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCB0ZXh0ID0gbGluay50ZXh0Q29udGVudC50cmltKCk7CiAgICAgICAgICAgICAgICBjb25zdCBpc0NhckxpbmsgPSAvXkNBUi1cZCskLy50ZXN0KHRleHQpOwogICAgICAgICAgICAgICAgY29uc29sZS5sb2coYExpbmsgdGV4dDogIiR7dGV4dH0iLCBtYXRjaGVzIENBUiBwYXR0ZXJuOiAke2lzQ2FyTGlua30sIGhyZWY6ICR7bGluay5ocmVmfWApOwogICAgICAgICAgICAgICAgcmV0dXJuIGlzQ2FyTGluazsKICAgICAgICAgICAgfSk7CiAgICAgICAgCiAgICAgICAgY29uc29sZS5sb2coYEZvdW5kICR7Y2FyTGlua3MubGVuZ3RofSBDQVIgbnVtYmVyIGxpbmtzYCk7CiAgICAgICAgCiAgICAgICAgY2FyTGlua3MuZm9yRWFjaCgobGluaywgaW5kZXgpID0+IHsKICAgICAgICAgICAgY29uc3QgY2FySWQgPSBsaW5rLnRleHRDb250ZW50LnRyaW0oKTsKICAgICAgICAgICAgY29uc29sZS5sb2coYENBUiBsaW5rICR7aW5kZXggKyAxfTogJHtjYXJJZH0gLT4gJHtsaW5rLmhyZWZ9YCk7CiAgICAgICAgICAgIAogICAgICAgICAgICBsaW5rcy5wdXNoKHsKICAgICAgICAgICAgICAgIGNhcklkOiBjYXJJZCwKICAgICAgICAgICAgICAgIHVybDogbGluay5ocmVmLAogICAgICAgICAgICAgICAgZWxlbWVudDogbGluaywKICAgICAgICAgICAgICAgIG1ldGhvZDogJ2Nhci1udW1iZXItbGluaycKICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgICAgCiAgICAgICAgLy8gTWV0aG9kIDI6IExvb2sgaW4gdGFibGUgY2VsbHMgZm9yIENBUiBwYXR0ZXJucwogICAgICAgIGNvbnNvbGUubG9nKCdNZXRob2QgMjogTG9va2luZyBpbiB0YWJsZSBjZWxscy4uLicpOwogICAgICAgIGNvbnN0IHRhYmxlQ2VsbHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCd0ZCwgdGgnKTsKICAgICAgICBjb25zb2xlLmxvZyhgRm91bmQgJHt0YWJsZUNlbGxzLmxlbmd0aH0gdGFibGUgY2VsbHMgdG8gY2hlY2tgKTsKICAgICAgICAKICAgICAgICB0YWJsZUNlbGxzLmZvckVhY2goKGNlbGwsIGluZGV4KSA9PiB7CiAgICAgICAgICAgIGNvbnN0IGNlbGxUZXh0ID0gY2VsbC50ZXh0Q29udGVudC50cmltKCk7CiAgICAgICAgICAgIGNvbnN0IGNhck1hdGNoID0gY2VsbFRleHQubWF0Y2goL15DQVItXGQrJC8pOwogICAgICAgICAgICBpZiAoY2FyTWF0Y2gpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBDZWxsICR7aW5kZXh9OiBGb3VuZCBDQVIgJHtjYXJNYXRjaFswXX1gKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gTG9vayBmb3IgbGlua3Mgd2l0aGluIHRoaXMgY2VsbAogICAgICAgICAgICAgICAgY29uc3QgY2VsbExpbmtzID0gY2VsbC5xdWVyeVNlbGVjdG9yQWxsKCdhJyk7CiAgICAgICAgICAgICAgICBpZiAoY2VsbExpbmtzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBsaW5rID0gY2VsbExpbmtzWzBdOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGNhcklkID0gY2FyTWF0Y2hbMF07CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgKCFsaW5rcy5maW5kKGwgPT4gbC5jYXJJZCA9PT0gY2FySWQpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGAgIEFkZGluZyBsaW5rOiAke2xpbmsuaHJlZn1gKTsKICAgICAgICAgICAgICAgICAgICAgICAgbGlua3MucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXJJZDogY2FySWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmw6IGxpbmsuaHJlZiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQ6IGxpbmssCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICd0YWJsZS1jZWxsJwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICAKICAgICAgICBjb25zb2xlLmxvZyhgVG90YWwgdW5pcXVlIENBUiBsaW5rcyBmb3VuZDogJHtsaW5rcy5sZW5ndGh9YCk7CiAgICAgICAgbGlua3MuZm9yRWFjaCgobGluaywgaW5kZXgpID0+IHsKICAgICAgICAgICAgY29uc29sZS5sb2coYCR7aW5kZXggKyAxfS4gJHtsaW5rLmNhcklkfSAtICR7bGluay51cmx9IChtZXRob2Q6ICR7bGluay5tZXRob2R9KWApOwogICAgICAgIH0pOwogICAgICAgIAogICAgICAgIHJldHVybiBsaW5rczsKICAgIH0KCiAgICAvLyBGdW5jdGlvbiB0byBleHRyYWN0IGRhdGEgZnJvbSB0aGUgY3VycmVudCBDQVIgZGV0YWlscyBwYWdlCiAgICBmdW5jdGlvbiBleHRyYWN0RGF0YUZyb21DdXJyZW50UGFnZSgpIHsKICAgICAgICBjb25zb2xlLmxvZygnU3RhcnRpbmcgZGF0YSBleHRyYWN0aW9uIGZyb20gY3VycmVudCBwYWdlLi4uJyk7CiAgICAgICAgCiAgICAgICAgY29uc3QgZGF0YSA9IHsKICAgICAgICAgICAgY2FySWQ6ICcnLAogICAgICAgICAgICByYWlzZWREYXRlOiAnJywKICAgICAgICAgICAgc3RhZ2VPd25lcjogJycsCiAgICAgICAgICAgIHRhcmdldERhdGU6ICcnLAogICAgICAgICAgICBzdGF0dXM6ICcnLAogICAgICAgICAgICByZW1hcmtzOiAnJywKICAgICAgICAgICAgZXJyb3I6IG51bGwKICAgICAgICB9OwoKICAgICAgICB0cnkgewogICAgICAgICAgICAvLyBUcnkgdG8gZ2V0IENBUiBJRCBmcm9tIFVSTCBvciBwYWdlCiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdFeHRyYWN0aW5nIENBUiBJRC4uLicpOwogICAgICAgICAgICBjb25zdCB1cmxNYXRjaCA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmLm1hdGNoKC9cLyhbQS1GYS1mMC05LV0rKSMhLyk7CiAgICAgICAgICAgIGlmICh1cmxNYXRjaCkgewogICAgICAgICAgICAgICAgLy8gTG9vayBmb3IgQ0FSIElEIG9uIHRoZSBwYWdlCiAgICAgICAgICAgICAgICBjb25zdCBwYWdlVGV4dCA9IGRvY3VtZW50LmJvZHkudGV4dENvbnRlbnQ7CiAgICAgICAgICAgICAgICBjb25zdCBjYXJNYXRjaCA9IHBhZ2VUZXh0Lm1hdGNoKC9DQVItXGQrLyk7CiAgICAgICAgICAgICAgICBpZiAoY2FyTWF0Y2gpIHsKICAgICAgICAgICAgICAgICAgICBkYXRhLmNhcklkID0gY2FyTWF0Y2hbMF07CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0ZvdW5kIENBUiBJRDonLCBkYXRhLmNhcklkKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gRXh0cmFjdCBSYWlzZWQgRGF0ZQogICAgICAgICAgICBjb25zb2xlLmxvZygnRXh0cmFjdGluZyByYWlzZWQgZGF0ZS4uLicpOwogICAgICAgICAgICBjb25zdCBhbGxMYWJlbHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdkaXYuZGV0YWlscy1sYWJlbCwgLmctbGFiZWwsIGxhYmVsJyk7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBGb3VuZCAke2FsbExhYmVscy5sZW5ndGh9IGxhYmVsIGVsZW1lbnRzYCk7CiAgICAgICAgICAgIAogICAgICAgICAgICBhbGxMYWJlbHMuZm9yRWFjaCgobGFiZWwsIGluZGV4KSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBsYWJlbFRleHQgPSAobGFiZWwudGV4dENvbnRlbnQgfHwgbGFiZWwuaW5uZXJUZXh0KS50cmltKCkudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgICAgIGlmIChsYWJlbFRleHQuaW5jbHVkZXMoJ3JhaXNlZCBkYXRlJykgfHwgbGFiZWxUZXh0ID09PSAncmFpc2VkIGRhdGU6JykgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBGb3VuZCByYWlzZWQgZGF0ZSBsYWJlbCBhdCBpbmRleCAke2luZGV4fTpgLCBsYWJlbFRleHQpOwogICAgICAgICAgICAgICAgICAgIGxldCB2YWx1ZUVsZW1lbnQgPSBsYWJlbC5uZXh0RWxlbWVudFNpYmxpbmc7CiAgICAgICAgICAgICAgICAgICAgaWYgKCF2YWx1ZUVsZW1lbnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWVFbGVtZW50ID0gbGFiZWwucGFyZW50RWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuc3RhdGljVGV4dCwgLmctdmFsdWUnKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKCF2YWx1ZUVsZW1lbnQgJiYgbGFiZWwucGFyZW50RWxlbWVudCkgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwYXJlbnRUZXh0ID0gbGFiZWwucGFyZW50RWxlbWVudC50ZXh0Q29udGVudDsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZGF0ZU1hdGNoID0gcGFyZW50VGV4dC5tYXRjaCgvXGJcZHsxLDJ9XC9cZHsxLDJ9XC9cZHs0fVxiLyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRlTWF0Y2gpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEucmFpc2VkRGF0ZSA9IGRhdGVNYXRjaFswXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdGb3VuZCByYWlzZWQgZGF0ZSBmcm9tIHBhcmVudDonLCBkYXRhLnJhaXNlZERhdGUpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh2YWx1ZUVsZW1lbnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZGF0ZU1hdGNoID0gdmFsdWVFbGVtZW50LnRleHRDb250ZW50Lm1hdGNoKC9cYlxkezEsMn1cL1xkezEsMn1cL1xkezR9XGIvKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGVNYXRjaCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5yYWlzZWREYXRlID0gZGF0ZU1hdGNoWzBdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0ZvdW5kIHJhaXNlZCBkYXRlIGZyb20gdmFsdWUgZWxlbWVudDonLCBkYXRhLnJhaXNlZERhdGUpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIC8vIEV4dHJhY3Qgc3RhZ2UgaW5mb3JtYXRpb24KICAgICAgICAgICAgY29uc29sZS5sb2coJ0V4dHJhY3Rpbmcgc3RhZ2UgaW5mb3JtYXRpb24uLi4nKTsKICAgICAgICAgICAgY29uc3Qgc3RhZ2VzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgibGkuc3RhZ2UtbGkiKTsKICAgICAgICAgICAgY29uc29sZS5sb2coYEZvdW5kICR7c3RhZ2VzLmxlbmd0aH0gc3RhZ2UgZWxlbWVudHNgKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGxldCBpbnZlc3RpZ2F0aW9uQ29tcGxldGVkID0gZmFsc2U7CiAgICAgICAgICAgIGxldCBpbnZlc3RpZ2F0aW9uRGF0YSA9IHt9OwogICAgICAgICAgICBsZXQgcWFEYXRhID0ge307CgogICAgICAgICAgICBzdGFnZXMuZm9yRWFjaCgoc3RhZ2UsIHN0YWdlSW5kZXgpID0+IHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBQcm9jZXNzaW5nIHN0YWdlICR7c3RhZ2VJbmRleH0uLi5gKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZnVuY3Rpb24gZmluZFNpYmxpbmdEYXRhKGxhYmVsVGV4dCkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGxhYmVsID0gQXJyYXkuZnJvbShzdGFnZS5xdWVyeVNlbGVjdG9yQWxsKCdkaXYuZGV0YWlscy1sYWJlbCcpKQogICAgICAgICAgICAgICAgICAgICAgICAuZmluZChlbCA9PiBlbC50ZXh0Q29udGVudC50cmltKCkgPT09IGxhYmVsVGV4dCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGxhYmVsICYmIGxhYmVsLm5leHRFbGVtZW50U2libGluZykgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzdGF0aWNUZXh0ID0gbGFiZWwubmV4dEVsZW1lbnRTaWJsaW5nLnF1ZXJ5U2VsZWN0b3IoJy5zdGF0aWNUZXh0Jyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzdGF0aWNUZXh0ID8gc3RhdGljVGV4dC50ZXh0Q29udGVudC50cmltKCkgOiBsYWJlbC5uZXh0RWxlbWVudFNpYmxpbmcudGV4dENvbnRlbnQudHJpbSgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBmdW5jdGlvbiBmaW5kU3RhdGljVGV4dERhdGEobGFiZWxUZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgbGFiZWwgPSBBcnJheS5mcm9tKHN0YWdlLnF1ZXJ5U2VsZWN0b3JBbGwoJ2Rpdi5kZXRhaWxzLWxhYmVsJykpCiAgICAgICAgICAgICAgICAgICAgICAgIC5maW5kKGVsID0+IGVsLnRleHRDb250ZW50LnRyaW0oKSA9PT0gbGFiZWxUZXh0KTsKICAgICAgICAgICAgICAgICAgICBpZiAobGFiZWwgJiYgbGFiZWwubmV4dEVsZW1lbnRTaWJsaW5nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0YXRpY1RleHRDb250YWluZXIgPSBsYWJlbC5uZXh0RWxlbWVudFNpYmxpbmcucXVlcnlTZWxlY3RvcignLnN0YXRpY1RleHRDb250YWluZXInKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN0YXRpY1RleHRDb250YWluZXIgPyBzdGF0aWNUZXh0Q29udGFpbmVyLnRleHRDb250ZW50LnRyaW0oKSA6IG51bGw7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGNvbnN0IHN0YWdlVGV4dCA9IHN0YWdlLnRleHRDb250ZW50IHx8IHN0YWdlLmlubmVyVGV4dDsKICAgICAgICAgICAgICAgIGNvbnN0IGxvd2VyU3RhZ2VUZXh0ID0gc3RhZ2VUZXh0LnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgU3RhZ2UgJHtzdGFnZUluZGV4fSB0ZXh0IGNvbnRhaW5zOmAsIGxvd2VyU3RhZ2VUZXh0LnN1YnN0cmluZygwLCAxMDApKTsKCiAgICAgICAgICAgICAgICBpZiAobG93ZXJTdGFnZVRleHQuaW5jbHVkZXMoJ2ludmVzdGlnYXRpb24nKSkgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdGb3VuZCBpbnZlc3RpZ2F0aW9uIHN0YWdlJyk7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgb3duZXIgPSBmaW5kU2libGluZ0RhdGEoIlN0YWdlIE93bmVyOiIpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHRhcmdldERhdGUgPSBmaW5kU3RhdGljVGV4dERhdGEoIlRhcmdldCBEYXRlIik7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29tcGxldGVkRGF0ZSA9IGZpbmRTaWJsaW5nRGF0YSgiQ29tcGxldGVkIGRhdGUiKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBzdGF0dXMgPSBmaW5kU2libGluZ0RhdGEoIlN0YXR1czoiKTsKCiAgICAgICAgICAgICAgICAgICAgaW52ZXN0aWdhdGlvbkRhdGEgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG93bmVyOiBvd25lciA/IG93bmVyLnJlcGxhY2UoL0NhbmNlbHxTYXZlL2csICcnKS50cmltKCkgOiAnJywKICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0RGF0ZTogdGFyZ2V0RGF0ZSA/IHRhcmdldERhdGUucmVwbGFjZSgvQ2FuY2VsfFNhdmUvZywgJycpLnRyaW0oKSA6IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChjb21wbGV0ZWREYXRlID8gY29tcGxldGVkRGF0ZS5yZXBsYWNlKC9DYW5jZWx8U2F2ZS9nLCAnJykudHJpbSgpIDogJycpLAogICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IHN0YXR1cyA/IHN0YXR1cy5yZXBsYWNlKC9DYW5jZWx8U2F2ZS9nLCAnJykudHJpbSgpIDogJycKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdJbnZlc3RpZ2F0aW9uIGRhdGE6JywgaW52ZXN0aWdhdGlvbkRhdGEpOwoKICAgICAgICAgICAgICAgICAgICBpZiAoY29tcGxldGVkRGF0ZSB8fCAoc3RhdHVzICYmIHN0YXR1cy50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKCdjb21wbGV0ZScpKSkgewogICAgICAgICAgICAgICAgICAgICAgICBpbnZlc3RpZ2F0aW9uQ29tcGxldGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0ludmVzdGlnYXRpb24gbWFya2VkIGFzIGNvbXBsZXRlZCcpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAobG93ZXJTdGFnZVRleHQuaW5jbHVkZXMoJ3FhJykgJiYgbG93ZXJTdGFnZVRleHQuaW5jbHVkZXMoJ2ZvbGxvdycpKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0ZvdW5kIFFBIGZvbGxvdy11cCBzdGFnZScpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IG93bmVyID0gZmluZFNpYmxpbmdEYXRhKCJTdGFnZSBPd25lcjoiKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCB0YXJnZXREYXRlID0gZmluZFN0YXRpY1RleHREYXRhKCJUYXJnZXQgRGF0ZSIpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbXBsZXRlZERhdGUgPSBmaW5kU2libGluZ0RhdGEoIkNvbXBsZXRlZCBkYXRlIik7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RhdHVzID0gZmluZFNpYmxpbmdEYXRhKCJTdGF0dXM6Iik7CgogICAgICAgICAgICAgICAgICAgIHFhRGF0YSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgb3duZXI6IG93bmVyID8gb3duZXIucmVwbGFjZSgvQ2FuY2VsfFNhdmUvZywgJycpLnRyaW0oKSA6ICcnLAogICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXREYXRlOiB0YXJnZXREYXRlID8gdGFyZ2V0RGF0ZS5yZXBsYWNlKC9DYW5jZWx8U2F2ZS9nLCAnJykudHJpbSgpIDogCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGNvbXBsZXRlZERhdGUgPyBjb21wbGV0ZWREYXRlLnJlcGxhY2UoL0NhbmNlbHxTYXZlL2csICcnKS50cmltKCkgOiAnJyksCiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1czogc3RhdHVzID8gc3RhdHVzLnJlcGxhY2UoL0NhbmNlbHxTYXZlL2csICcnKS50cmltKCkgOiAnJwogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1FBIGRhdGE6JywgcWFEYXRhKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAvLyBEZXRlcm1pbmUgd2hpY2ggc3RhZ2UgdG8gc2hvdwogICAgICAgICAgICBjb25zb2xlLmxvZygnRGV0ZXJtaW5pbmcgd2hpY2ggc3RhZ2UgdG8gc2hvdy4uLicpOwogICAgICAgICAgICBjb25zb2xlLmxvZygnSW52ZXN0aWdhdGlvbiBjb21wbGV0ZWQ6JywgaW52ZXN0aWdhdGlvbkNvbXBsZXRlZCk7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdRQSBkYXRhIGF2YWlsYWJsZTonLCAhIXFhRGF0YS5vd25lcik7CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAoaW52ZXN0aWdhdGlvbkNvbXBsZXRlZCAmJiBxYURhdGEub3duZXIpIHsKICAgICAgICAgICAgICAgIGRhdGEuc3RhZ2VPd25lciA9IHFhRGF0YS5vd25lcjsKICAgICAgICAgICAgICAgIGRhdGEudGFyZ2V0RGF0ZSA9IHFhRGF0YS50YXJnZXREYXRlOwogICAgICAgICAgICAgICAgZGF0YS5zdGF0dXMgPSAnUUEgRm9sbG93LXVwJzsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gQ3JlYXRlIHJlbWFya3Mgd2l0aCB0b2RheSdzIGRhdGUgYW5kIHN0YWdlIGluZm8KICAgICAgICAgICAgICAgIGNvbnN0IHRvZGF5Rm9ybWF0dGVkID0gZm9ybWF0VG9kYXlGb3JSZW1hcmtzKCk7CiAgICAgICAgICAgICAgICBkYXRhLnJlbWFya3MgPSBgJHt0b2RheUZvcm1hdHRlZH06IFFBIEZvbGxvdy11cCAke3FhRGF0YS5vd25lcn1gOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnVXNpbmcgUUEgZGF0YScpOwogICAgICAgICAgICB9IGVsc2UgaWYgKGludmVzdGlnYXRpb25EYXRhLm93bmVyKSB7CiAgICAgICAgICAgICAgICBkYXRhLnN0YWdlT3duZXIgPSBpbnZlc3RpZ2F0aW9uRGF0YS5vd25lcjsKICAgICAgICAgICAgICAgIGRhdGEudGFyZ2V0RGF0ZSA9IGludmVzdGlnYXRpb25EYXRhLnRhcmdldERhdGU7CiAgICAgICAgICAgICAgICBkYXRhLnN0YXR1cyA9ICdJbnZlc3RpZ2F0aW9uJzsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gQ3JlYXRlIHJlbWFya3Mgd2l0aCB0b2RheSdzIGRhdGUgYW5kIHN0YWdlIGluZm8KICAgICAgICAgICAgICAgIGNvbnN0IHRvZGF5Rm9ybWF0dGVkID0gZm9ybWF0VG9kYXlGb3JSZW1hcmtzKCk7CiAgICAgICAgICAgICAgICBkYXRhLnJlbWFya3MgPSBgJHt0b2RheUZvcm1hdHRlZH06IEludmVzdGlnYXRpb24gJHtpbnZlc3RpZ2F0aW9uRGF0YS5vd25lcn1gOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnVXNpbmcgSW52ZXN0aWdhdGlvbiBkYXRhJyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdGaW5hbCBleHRyYWN0ZWQgZGF0YTonLCBkYXRhKTsKCiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZHVyaW5nIGRhdGEgZXh0cmFjdGlvbjonLCBlcnJvcik7CiAgICAgICAgICAgIGRhdGEuZXJyb3IgPSBlcnJvci5tZXNzYWdlOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGRhdGE7CiAgICB9CgogICAgLy8gRnVuY3Rpb24gdG8gaGFuZGxlIGRhdGEgZXh0cmFjdGlvbiBpbiBhIENBUiBkZXRhaWxzIHdpbmRvdwogICAgZnVuY3Rpb24gaGFuZGxlQ2FyRGV0YWlsc1dpbmRvdygpIHsKICAgICAgICBjb25zb2xlLmxvZygn8J+UjSBDQVIgZGV0YWlscyB3aW5kb3cgbG9hZGVkLCBjaGVja2luZyBmb3IgZXh0cmFjdGlvbiB0YXNrLi4uJyk7CiAgICAgICAgY29uc29sZS5sb2coJ1dpbmRvdyBuYW1lOicsIHdpbmRvdy5uYW1lKTsKICAgICAgICAKICAgICAgICAvLyBUcnkgdG8gZmluZCB0aGUgZXh0cmFjdGlvbiB0YXNrIHRoYXQgbWF0Y2hlcyB0aGlzIHdpbmRvdwogICAgICAgIGNvbnN0IGFsbEtleXMgPSBPYmplY3Qua2V5cyhzZXNzaW9uU3RvcmFnZSk7CiAgICAgICAgY29uc3QgZXh0cmFjdGlvbktleXMgPSBhbGxLZXlzLmZpbHRlcihrZXkgPT4ga2V5LnN0YXJ0c1dpdGgoJ2NhckV4dHJhY3Rpb25fJykpOwogICAgICAgIAogICAgICAgIGNvbnNvbGUubG9nKCdBdmFpbGFibGUgZXh0cmFjdGlvbiBrZXlzOicsIGV4dHJhY3Rpb25LZXlzKTsKICAgICAgICAKICAgICAgICBpZiAoZXh0cmFjdGlvbktleXMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCfinYwgTm8gZXh0cmFjdGlvbiB0YXNrIGZvdW5kIGZvciB0aGlzIHdpbmRvdycpOwogICAgICAgICAgICBjb25zb2xlLmxvZygnQWxsIHNlc3Npb25TdG9yYWdlIGtleXM6JywgYWxsS2V5cyk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gRmluZCB0aGUgbW9zdCByZWNlbnQgZXh0cmFjdGlvbiB0YXNrIG9yIG9uZSB0aGF0IG1hdGNoZXMgdGhlIHdpbmRvdyBuYW1lCiAgICAgICAgbGV0IGV4dHJhY3Rpb25JbmZvID0gbnVsbDsKICAgICAgICBsZXQgZXh0cmFjdGlvbktleSA9IG51bGw7CiAgICAgICAgCiAgICAgICAgaWYgKHdpbmRvdy5uYW1lICYmIHdpbmRvdy5uYW1lLmluY2x1ZGVzKCdjYXJfd2luZG93XycpKSB7CiAgICAgICAgICAgIC8vIFRyeSB0byBtYXRjaCBieSB3aW5kb3cgbmFtZQogICAgICAgICAgICBjb25zdCB3aW5kb3dJZCA9IHdpbmRvdy5uYW1lLnJlcGxhY2UoJ2Nhcl93aW5kb3dfJywgJycpOwogICAgICAgICAgICBleHRyYWN0aW9uS2V5ID0gYGNhckV4dHJhY3Rpb25fJHt3aW5kb3dJZH1gOwogICAgICAgICAgICBpZiAoc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbShleHRyYWN0aW9uS2V5KSkgewogICAgICAgICAgICAgICAgZXh0cmFjdGlvbkluZm8gPSBKU09OLnBhcnNlKHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oZXh0cmFjdGlvbktleSkpOwogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ+KchSBGb3VuZCBleHRyYWN0aW9uIHRhc2sgYnkgd2luZG93IG5hbWU6JywgZXh0cmFjdGlvbkluZm8pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIElmIG5vdCBmb3VuZCBieSB3aW5kb3cgbmFtZSwgdXNlIHRoZSBmaXJzdCBhdmFpbGFibGUgb25lCiAgICAgICAgaWYgKCFleHRyYWN0aW9uSW5mbyAmJiBleHRyYWN0aW9uS2V5cy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIGV4dHJhY3Rpb25LZXkgPSBleHRyYWN0aW9uS2V5c1swXTsKICAgICAgICAgICAgZXh0cmFjdGlvbkluZm8gPSBKU09OLnBhcnNlKHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oZXh0cmFjdGlvbktleSkpOwogICAgICAgICAgICBjb25zb2xlLmxvZygn8J+TiyBVc2luZyBmaXJzdCBhdmFpbGFibGUgZXh0cmFjdGlvbiB0YXNrOicsIGV4dHJhY3Rpb25JbmZvKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgaWYgKCFleHRyYWN0aW9uSW5mbykgewogICAgICAgICAgICBjb25zb2xlLmxvZygn4p2MIENvdWxkIG5vdCBmaW5kIHZhbGlkIGV4dHJhY3Rpb24gaW5mbycpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIE1hcmsgdGhpcyBleHRyYWN0aW9uIGFzIGJlaW5nIHByb2Nlc3NlZCB0byBhdm9pZCBjb25mbGljdHMKICAgICAgICBleHRyYWN0aW9uSW5mby5wcm9jZXNzaW5nID0gdHJ1ZTsKICAgICAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKGV4dHJhY3Rpb25LZXksIEpTT04uc3RyaW5naWZ5KGV4dHJhY3Rpb25JbmZvKSk7CiAgICAgICAgCiAgICAgICAgLy8gV2FpdCBmb3IgcGFnZSB0byBsb2FkIGNvbXBsZXRlbHksIHRoZW4gZXh0cmFjdCBkYXRhCiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGDwn5qAIEV4dHJhY3RpbmcgZGF0YSBmb3IgJHtleHRyYWN0aW9uSW5mby5jYXJJZH0gKCR7ZXh0cmFjdGlvbkluZm8uZXh0cmFjdGlvbklkfSkuLi5gKTsKICAgICAgICAgICAgY29uc29sZS5sb2coJ0N1cnJlbnQgcGFnZSB0aXRsZTonLCBkb2N1bWVudC50aXRsZSk7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdQYWdlIGZ1bGx5IGxvYWRlZCwgY2hlY2tpbmcgZm9yIHN0YWdlIGVsZW1lbnRzLi4uJyk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBDaGVjayBpZiBzdGFnZSBlbGVtZW50cyBleGlzdAogICAgICAgICAgICBjb25zdCBzdGFnZXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCJsaS5zdGFnZS1saSIpOwogICAgICAgICAgICBjb25zb2xlLmxvZyhgRm91bmQgJHtzdGFnZXMubGVuZ3RofSBzdGFnZSBlbGVtZW50c2ApOwogICAgICAgICAgICAKICAgICAgICAgICAgY29uc3QgY2FyRGF0YSA9IGV4dHJhY3REYXRhRnJvbUN1cnJlbnRQYWdlKCk7CiAgICAgICAgICAgIGNhckRhdGEuY2FySWQgPSBleHRyYWN0aW9uSW5mby5jYXJJZDsgLy8gRW5zdXJlIGNvcnJlY3QgQ0FSIElECiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zb2xlLmxvZyhg8J+TiiBFeHRyYWN0ZWQgZGF0YSBmb3IgJHtleHRyYWN0aW9uSW5mby5jYXJJZH06YCwgY2FyRGF0YSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBTZW5kIGRhdGEgYmFjayB0byBwYXJlbnQgd2luZG93CiAgICAgICAgICAgIGlmICh3aW5kb3cub3BlbmVyICYmICF3aW5kb3cub3BlbmVyLmNsb3NlZCkgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ/Cfk6QgU2VuZGluZyBkYXRhIHRvIHBhcmVudCB3aW5kb3cuLi4nKTsKICAgICAgICAgICAgICAgIHdpbmRvdy5vcGVuZXIucG9zdE1lc3NhZ2UoewogICAgICAgICAgICAgICAgICAgIHR5cGU6ICdDQVJfREFUQV9FWFRSQUNURUQnLAogICAgICAgICAgICAgICAgICAgIGV4dHJhY3Rpb25JZDogZXh0cmFjdGlvbkluZm8uZXh0cmFjdGlvbklkLAogICAgICAgICAgICAgICAgICAgIGNhckRhdGE6IGNhckRhdGEKICAgICAgICAgICAgICAgIH0sICcqJyk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCfinIUgRGF0YSBzZW50IHRvIHBhcmVudCB3aW5kb3cnKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gQ2xlYW4gdXAgdGhpcyBleHRyYWN0aW9uIHRhc2sgaW1tZWRpYXRlbHkKICAgICAgICAgICAgICAgIHNlc3Npb25TdG9yYWdlLnJlbW92ZUl0ZW0oZXh0cmFjdGlvbktleSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIENsb3NlIHRoZSB3aW5kb3cgYWZ0ZXIgYSBicmllZiBkZWxheQogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ/CflJogQ2xvc2luZyBwb3B1cCB3aW5kb3cuLi4nKTsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cuY2xvc2UoKTsKICAgICAgICAgICAgICAgIH0sIDEwMDApOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcign4p2MIFBhcmVudCB3aW5kb3cgbm90IGF2YWlsYWJsZScpOwogICAgICAgICAgICAgICAgc2Vzc2lvblN0b3JhZ2UucmVtb3ZlSXRlbShleHRyYWN0aW9uS2V5KTsKICAgICAgICAgICAgICAgIHdpbmRvdy5jbG9zZSgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgIH0sIDUwMDApOyAvLyBXYWl0IDUgc2Vjb25kcyBmb3IgcGFnZSB0byBmdWxseSBsb2FkCiAgICB9CgogICAgLy8gRnVuY3Rpb24gdG8gcHJvY2VzcyBhIHNpbmdsZSBDQVIgYnkgb3BlbmluZyBpdCBpbiBhIG5ldyB3aW5kb3cKICAgIGFzeW5jIGZ1bmN0aW9uIHByb2Nlc3NDYXJMaW5rKGNhckxpbmssIGluZGV4LCB0b3RhbCwgaXNSZWZyZXNoID0gZmFsc2UpIHsKICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICAgICAgaWYgKCFpc1JlZnJlc2gpIHsKICAgICAgICAgICAgICAgIHVwZGF0ZVN0YXR1cyhgT3BlbmluZyAke2NhckxpbmsuY2FySWR9ICgke2luZGV4ICsgMX0vJHt0b3RhbH0pIGluIG5ldyB3aW5kb3cuLi5gKTsKICAgICAgICAgICAgICAgIC8vIEFkZCBsb2FkaW5nIGVudHJ5IHRvIHJpYmJvbgogICAgICAgICAgICAgICAgYWRkQ2FyRW50cnkoY2FyTGluay5jYXJJZCwgbnVsbCwgdHJ1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBPcGVuaW5nICR7Y2FyTGluay5jYXJJZH0gaW4gbmV3IHdpbmRvdzogJHtjYXJMaW5rLnVybH1gKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIENyZWF0ZSBhIHVuaXF1ZSBpZGVudGlmaWVyIGZvciB0aGlzIGV4dHJhY3Rpb24gdXNpbmcgbW9yZSBzcGVjaWZpY2l0eQogICAgICAgICAgICBjb25zdCBleHRyYWN0aW9uSWQgPSBgJHtEYXRlLm5vdygpfV8ke2luZGV4fV8ke2NhckxpbmsuY2FySWQucmVwbGFjZSgvW15hLXpBLVowLTldL2csICcnKX1gOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gU3RvcmUgZXh0cmFjdGlvbiBpbmZvIHRoYXQgdGhlIG5ldyB3aW5kb3cgY2FuIGFjY2VzcwogICAgICAgICAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKGBjYXJFeHRyYWN0aW9uXyR7ZXh0cmFjdGlvbklkfWAsIEpTT04uc3RyaW5naWZ5KHsKICAgICAgICAgICAgICAgIGNhcklkOiBjYXJMaW5rLmNhcklkLAogICAgICAgICAgICAgICAgaW5kZXg6IGluZGV4LAogICAgICAgICAgICAgICAgdG90YWw6IHRvdGFsLAogICAgICAgICAgICAgICAgZXh0cmFjdGlvbklkOiBleHRyYWN0aW9uSWQsCiAgICAgICAgICAgICAgICBpc1JlZnJlc2g6IGlzUmVmcmVzaAogICAgICAgICAgICB9KSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBPcGVuIHRoZSBDQVIgZGV0YWlscyBwYWdlIGluIGEgbmV3IHdpbmRvdyB3aXRoIHVuaXF1ZSB3aW5kb3cgbmFtZQogICAgICAgICAgICBjb25zdCBkZXRhaWxzVXJsID0gY2FyTGluay51cmwgKyAnIyEvZGV0YWlscyc7CiAgICAgICAgICAgIGNvbnN0IHdpbmRvd05hbWUgPSBgY2FyX3dpbmRvd18ke2V4dHJhY3Rpb25JZH1gOwogICAgICAgICAgICBjb25zdCBuZXdXaW5kb3cgPSB3aW5kb3cub3BlbihkZXRhaWxzVXJsLCB3aW5kb3dOYW1lLCAnd2lkdGg9MTIwMCxoZWlnaHQ9ODAwJyk7CiAgICAgICAgICAgIAogICAgICAgICAgICBsZXQgcmVzb2x2ZWQgPSBmYWxzZTsgLy8gRmxhZyB0byBwcmV2ZW50IG11bHRpcGxlIHJlc29sdXRpb25zCiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBTZXQgdXAgYSBtZXNzYWdlIGxpc3RlbmVyIHRvIHJlY2VpdmUgZGF0YSBmcm9tIHRoZSBuZXcgd2luZG93CiAgICAgICAgICAgIGNvbnN0IG1lc3NhZ2VIYW5kbGVyID0gKGV2ZW50KSA9PiB7CiAgICAgICAgICAgICAgICAvLyBNb3JlIHNwZWNpZmljIGNoZWNrIGZvciB0aGlzIGV4YWN0IGV4dHJhY3Rpb24KICAgICAgICAgICAgICAgIGlmIChldmVudC5kYXRhICYmIAogICAgICAgICAgICAgICAgICAgIGV2ZW50LmRhdGEudHlwZSA9PT0gJ0NBUl9EQVRBX0VYVFJBQ1RFRCcgJiYgCiAgICAgICAgICAgICAgICAgICAgZXZlbnQuZGF0YS5leHRyYWN0aW9uSWQgPT09IGV4dHJhY3Rpb25JZCAmJgogICAgICAgICAgICAgICAgICAgICFyZXNvbHZlZCkgewogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHJlc29sdmVkID0gdHJ1ZTsgLy8gTWFyayBhcyByZXNvbHZlZCB0byBwcmV2ZW50IGR1cGxpY2F0ZXMKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhg4pyFIFJlY2VpdmVkIGRhdGEgZm9yICR7Y2FyTGluay5jYXJJZH0gKCR7ZXh0cmFjdGlvbklkfSk6YCwgZXZlbnQuZGF0YS5jYXJEYXRhKTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyBIYW5kbGUgcmVmcmVzaCBtb2RlIGRpZmZlcmVudGx5CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzUmVmcmVzaCkgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBVcGRhdGUgZXhpc3RpbmcgZGF0YSBpbiBleHRyYWN0ZWREYXRhIGFycmF5CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGV4aXN0aW5nSW5kZXggPSBleHRyYWN0ZWREYXRhLmZpbmRJbmRleChkYXRhID0+IGRhdGEuY2FySWQgPT09IGNhckxpbmsuY2FySWQpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXhpc3RpbmdJbmRleCAhPT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4dHJhY3RlZERhdGFbZXhpc3RpbmdJbmRleF0gPSBldmVudC5kYXRhLmNhckRhdGE7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHRyYWN0ZWREYXRhLnB1c2goZXZlbnQuZGF0YS5jYXJEYXRhKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIE5vcm1hbCBtb2RlIC0gYWRkIHRvIGFycmF5CiAgICAgICAgICAgICAgICAgICAgICAgIGV4dHJhY3RlZERhdGEucHVzaChldmVudC5kYXRhLmNhckRhdGEpOwogICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVQcm9ncmVzcyhpbmRleCArIDEsIHRvdGFsKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gVXBkYXRlIHRoZSByaWJib24gd2l0aCBleHRyYWN0ZWQgZGF0YQogICAgICAgICAgICAgICAgICAgIHVwZGF0ZUNhckVudHJ5KGNhckxpbmsuY2FySWQsIGV2ZW50LmRhdGEuY2FyRGF0YSk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gQ2xlYW4gdXAgdGhlIG1lc3NhZ2UgbGlzdGVuZXIgZmlyc3QKICAgICAgICAgICAgICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIG1lc3NhZ2VIYW5kbGVyKTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyBJbW1lZGlhdGUgY2xlYW51cCBhbmQgcmVzb2x1dGlvbgogICAgICAgICAgICAgICAgICAgIHNlc3Npb25TdG9yYWdlLnJlbW92ZUl0ZW0oYGNhckV4dHJhY3Rpb25fJHtleHRyYWN0aW9uSWR9YCk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gQ2xvc2UgdGhlIG5ldyB3aW5kb3cKICAgICAgICAgICAgICAgICAgICBpZiAobmV3V2luZG93ICYmICFuZXdXaW5kb3cuY2xvc2VkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5ld1dpbmRvdy5jbG9zZSgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyBSZXNvbHZlIGltbWVkaWF0ZWx5CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgICAgICAKICAgICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCBtZXNzYWdlSGFuZGxlcik7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBTZXQgdXAgYSB0aW1lb3V0IGluIGNhc2UgdGhlIG5ldyB3aW5kb3cgZG9lc24ndCByZXNwb25kCiAgICAgICAgICAgIGNvbnN0IHRpbWVvdXRJZCA9IHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgaWYgKCFyZXNvbHZlZCkgewogICAgICAgICAgICAgICAgICAgIHJlc29sdmVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhg4o+wIFRpbWVvdXQgcmVhY2hlZCBmb3IgJHtjYXJMaW5rLmNhcklkfSAoJHtleHRyYWN0aW9uSWR9KWApOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmIChuZXdXaW5kb3cgJiYgIW5ld1dpbmRvdy5jbG9zZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbmV3V2luZG93LmNsb3NlKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgbWVzc2FnZUhhbmRsZXIpOwogICAgICAgICAgICAgICAgICAgIHNlc3Npb25TdG9yYWdlLnJlbW92ZUl0ZW0oYGNhckV4dHJhY3Rpb25fJHtleHRyYWN0aW9uSWR9YCk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gQWRkIGVycm9yIGVudHJ5IGlmIHdlIGRpZG4ndCBnZXQgZGF0YQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGVycm9yRGF0YSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgY2FySWQ6IGNhckxpbmsuY2FySWQsCiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yOiAnVGltZW91dCAtIHdpbmRvdyBkaWQgbm90IHJlc3BvbmQnCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICB1cGRhdGVDYXJFbnRyeShjYXJMaW5rLmNhcklkLCBlcnJvckRhdGEpOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmICghaXNSZWZyZXNoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGV4dHJhY3RlZERhdGEucHVzaChlcnJvckRhdGEpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIDIwMDAwKTsgLy8gSW5jcmVhc2VkIHRvIDIwIHNlY29uZCB0aW1lb3V0CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBBbHNvIGxpc3RlbiBmb3Igd2luZG93IGNsb3NlIGV2ZW50cyB0byBjbGVhbiB1cAogICAgICAgICAgICBjb25zdCBjaGVja1dpbmRvd0Nsb3NlZCA9IHNldEludGVydmFsKCgpID0+IHsKICAgICAgICAgICAgICAgIGlmIChuZXdXaW5kb3cuY2xvc2VkICYmICFyZXNvbHZlZCkgewogICAgICAgICAgICAgICAgICAgIHJlc29sdmVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBjbGVhckludGVydmFsKGNoZWNrV2luZG93Q2xvc2VkKTsKICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGltZW91dElkKTsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIG1lc3NhZ2VIYW5kbGVyKTsKICAgICAgICAgICAgICAgICAgICBzZXNzaW9uU3RvcmFnZS5yZW1vdmVJdGVtKGBjYXJFeHRyYWN0aW9uXyR7ZXh0cmFjdGlvbklkfWApOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGDwn5S0IFdpbmRvdyBjbG9zZWQgYmVmb3JlIGRhdGEgcmVjZWl2ZWQgZm9yICR7Y2FyTGluay5jYXJJZH1gKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBlcnJvckRhdGEgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhcklkOiBjYXJMaW5rLmNhcklkLAogICAgICAgICAgICAgICAgICAgICAgICBlcnJvcjogJ1dpbmRvdyBjbG9zZWQgYmVmb3JlIGRhdGEgZXh0cmFjdGlvbicKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIHVwZGF0ZUNhckVudHJ5KGNhckxpbmsuY2FySWQsIGVycm9yRGF0YSk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgKCFpc1JlZnJlc2gpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZXh0cmFjdGVkRGF0YS5wdXNoKGVycm9yRGF0YSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHJlc29sdmUoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgMTAwMCk7CiAgICAgICAgfSk7CiAgICB9CgogICAgLy8gRnVuY3Rpb24gdG8gYWRkIGEgQ0FSIGVudHJ5IHRvIHRoZSByaWJib24KICAgIGZ1bmN0aW9uIGFkZENhckVudHJ5KGNhcklkLCBkYXRhLCBpc0xvYWRpbmcgPSBmYWxzZSkgewogICAgICAgIGNvbnN0IHJlc3VsdHNEaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2FyLXJlc3VsdHMnKTsKICAgICAgICAKICAgICAgICBsZXQgZW50cnlDbGFzcyA9ICdjYXItZW50cnknOwogICAgICAgIGlmIChpc0xvYWRpbmcpIGVudHJ5Q2xhc3MgKz0gJyBsb2FkaW5nJzsKICAgICAgICBpZiAoZGF0YSAmJiBkYXRhLmVycm9yKSBlbnRyeUNsYXNzICs9ICcgZXJyb3InOwogICAgICAgIAogICAgICAgIGNvbnN0IGVudHJ5RGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgZW50cnlEaXYuY2xhc3NOYW1lID0gZW50cnlDbGFzczsKICAgICAgICBlbnRyeURpdi5pZCA9IGBjYXItZW50cnktJHtjYXJJZH1gOwogICAgICAgIAogICAgICAgIGlmIChpc0xvYWRpbmcpIHsKICAgICAgICAgICAgZW50cnlEaXYuaW5uZXJIVE1MID0gYAogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY2FyLWlkIj4ke2NhcklkfTwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY2FyLWRldGFpbHMiPkxvYWRpbmcuLi48L2Rpdj4KICAgICAgICAgICAgYDsKICAgICAgICB9IGVsc2UgaWYgKGRhdGEgJiYgZGF0YS5lcnJvcikgewogICAgICAgICAgICBlbnRyeURpdi5pbm5lckhUTUwgPSBgCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjYXItaWQiPiR7Y2FySWR9PC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjYXItZGV0YWlscyIgc3R5bGU9ImNvbG9yOiAjZmNhNWE1OyI+RXJyb3I6ICR7ZGF0YS5lcnJvcn08L2Rpdj4KICAgICAgICAgICAgYDsKICAgICAgICB9IGVsc2UgaWYgKGRhdGEpIHsKICAgICAgICAgICAgZW50cnlEaXYuaW5uZXJIVE1MID0gYAogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY2FyLWlkIj4ke2NhcklkfTwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY2FyLWRldGFpbHMiPgogICAgICAgICAgICAgICAgICAgIDxkaXY+PHN0cm9uZz5SYWlzZWQ6PC9zdHJvbmc+ICR7ZGF0YS5yYWlzZWREYXRlIHx8ICdVbmtub3duJ308L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8ZGl2PjxzdHJvbmc+T3duZXI6PC9zdHJvbmc+ICR7ZGF0YS5zdGFnZU93bmVyIHx8ICdVbmtub3duJ308L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8ZGl2PjxzdHJvbmc+VGFyZ2V0Ojwvc3Ryb25nPiAke2RhdGEudGFyZ2V0RGF0ZSB8fCAnVW5rbm93bid9PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPGRpdj48c3Ryb25nPlN0YXR1czo8L3N0cm9uZz4gJHtkYXRhLnN0YXR1cyB8fCAnVW5rbm93bid9PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPGRpdj48c3Ryb25nPlJlbWFya3M6PC9zdHJvbmc+ICR7ZGF0YS5yZW1hcmtzIHx8ICdVbmtub3duJ308L2Rpdj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICBgOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBBZGQgcmlnaHQtY2xpY2sgY29udGV4dCBtZW51IGZ1bmN0aW9uYWxpdHkKICAgICAgICBlbnRyeURpdi5hZGRFdmVudExpc3RlbmVyKCdjb250ZXh0bWVudScsIChlKSA9PiBzaG93Q29udGV4dE1lbnUoZSwgY2FySWQpKTsKICAgICAgICAKICAgICAgICByZXN1bHRzRGl2LmFwcGVuZENoaWxkKGVudHJ5RGl2KTsKICAgICAgICByZXN1bHRzRGl2LnNjcm9sbFRvcCA9IHJlc3VsdHNEaXYuc2Nyb2xsSGVpZ2h0OwogICAgfQoKICAgIC8vIEZ1bmN0aW9uIHRvIHVwZGF0ZSBhbiBleGlzdGluZyBDQVIgZW50cnkKICAgIGZ1bmN0aW9uIHVwZGF0ZUNhckVudHJ5KGNhcklkLCBkYXRhKSB7CiAgICAgICAgY29uc3QgZW50cnlEaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgY2FyLWVudHJ5LSR7Y2FySWR9YCk7CiAgICAgICAgaWYgKGVudHJ5RGl2KSB7CiAgICAgICAgICAgIGVudHJ5RGl2LmNsYXNzTmFtZSA9ICdjYXItZW50cnknICsgKGRhdGEuZXJyb3IgPyAnIGVycm9yJyA6ICcnKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIChkYXRhLmVycm9yKSB7CiAgICAgICAgICAgICAgICBlbnRyeURpdi5pbm5lckhUTUwgPSBgCiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY2FyLWlkIj4ke2NhcklkfTwvZGl2PgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNhci1kZXRhaWxzIiBzdHlsZT0iY29sb3I6ICNmY2E1YTU7Ij5FcnJvcjogJHtkYXRhLmVycm9yfTwvZGl2PgogICAgICAgICAgICAgICAgYDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGVudHJ5RGl2LmlubmVySFRNTCA9IGAKICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjYXItaWQiPiR7Y2FySWR9PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY2FyLWRldGFpbHMiPgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxzdHJvbmc+UmFpc2VkOjwvc3Ryb25nPiAke2RhdGEucmFpc2VkRGF0ZSB8fCAnVW5rbm93bid9PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+PHN0cm9uZz5Pd25lcjo8L3N0cm9uZz4gJHtkYXRhLnN0YWdlT3duZXIgfHwgJ1Vua25vd24nfTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxzdHJvbmc+VGFyZ2V0Ojwvc3Ryb25nPiAke2RhdGEudGFyZ2V0RGF0ZSB8fCAnVW5rbm93bid9PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+PHN0cm9uZz5TdGF0dXM6PC9zdHJvbmc+ICR7ZGF0YS5zdGF0dXMgfHwgJ1Vua25vd24nfTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxzdHJvbmc+UmVtYXJrczo8L3N0cm9uZz4gJHtkYXRhLnJlbWFya3MgfHwgJ1Vua25vd24nfTwvZGl2PgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgYDsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgLy8gUmUtYWRkIHJpZ2h0LWNsaWNrIGNvbnRleHQgbWVudSBmdW5jdGlvbmFsaXR5CiAgICAgICAgICAgIGVudHJ5RGl2LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NvbnRleHRtZW51JywgZW50cnlEaXYuX2NvbnRleHRNZW51SGFuZGxlcik7CiAgICAgICAgICAgIGVudHJ5RGl2Ll9jb250ZXh0TWVudUhhbmRsZXIgPSAoZSkgPT4gc2hvd0NvbnRleHRNZW51KGUsIGNhcklkKTsKICAgICAgICAgICAgZW50cnlEaXYuYWRkRXZlbnRMaXN0ZW5lcignY29udGV4dG1lbnUnLCBlbnRyeURpdi5fY29udGV4dE1lbnVIYW5kbGVyKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gQWxzbyBsb2cgdGhlIHVwZGF0ZSBmb3IgZGVidWdnaW5nCiAgICAgICAgY29uc29sZS5sb2coYFVwZGF0ZWQgcmliYm9uIGVudHJ5IGZvciAke2NhcklkfTpgLCBkYXRhKTsKICAgIH0KCiAgICAvLyBGdW5jdGlvbiB0byB1cGRhdGUgc3RhdHVzIG1lc3NhZ2UKICAgIGZ1bmN0aW9uIHVwZGF0ZVN0YXR1cyhtZXNzYWdlKSB7CiAgICAgICAgY29uc3Qgc3RhdHVzRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdGF0dXMtaW5mbycpOwogICAgICAgIGlmIChzdGF0dXNFbGVtZW50KSB7CiAgICAgICAgICAgIHN0YXR1c0VsZW1lbnQudGV4dENvbnRlbnQgPSBtZXNzYWdlOwogICAgICAgIH0KICAgIH0KCiAgICAvLyBGdW5jdGlvbiB0byB1cGRhdGUgcHJvZ3Jlc3MgYmFyCiAgICBmdW5jdGlvbiB1cGRhdGVQcm9ncmVzcyhjdXJyZW50LCB0b3RhbCkgewogICAgICAgIGNvbnN0IHByb2dyZXNzRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9ncmVzcy1pbmZvJyk7CiAgICAgICAgaWYgKHByb2dyZXNzRWxlbWVudCkgewogICAgICAgICAgICBpZiAodG90YWwgPT09IDApIHsKICAgICAgICAgICAgICAgIHByb2dyZXNzRWxlbWVudC50ZXh0Q29udGVudCA9ICdSZWFkeSB0byBleHRyYWN0IENBUiBkYXRhJzsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHByb2dyZXNzRWxlbWVudC50ZXh0Q29udGVudCA9IGBQcm9ncmVzczogJHtjdXJyZW50fS8ke3RvdGFsfSAoJHtNYXRoLnJvdW5kKChjdXJyZW50L3RvdGFsKSoxMDApfSUpYDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvLyBNYWluIGV4dHJhY3Rpb24gZnVuY3Rpb24KICAgIGFzeW5jIGZ1bmN0aW9uIHN0YXJ0RXh0cmFjdGlvbigpIHsKICAgICAgICBpZiAoZXh0cmFjdGlvbkluUHJvZ3Jlc3MgJiYgIWlzUGF1c2VkKSByZXR1cm47CiAgICAgICAgCiAgICAgICAgLy8gVXBkYXRlIGJ1dHRvbiBzdGF0ZXMKICAgICAgICB1cGRhdGVCdXR0b25TdGF0ZXMoJ2V4dHJhY3RpbmcnKTsKICAgICAgICAKICAgICAgICBpZiAoaXNQYXVzZWQpIHsKICAgICAgICAgICAgLy8gUmVzdW1lIGV4dHJhY3Rpb24KICAgICAgICAgICAgaXNQYXVzZWQgPSBmYWxzZTsKICAgICAgICAgICAgdXBkYXRlU3RhdHVzKGDwn5SEIFJlc3VtaW5nIGV4dHJhY3Rpb24gZnJvbSBDQVIgJHtjdXJyZW50Q2FySW5kZXggKyAxfS8ke2NhckxpbmtzLmxlbmd0aH0uLi5gKTsKICAgICAgICAgICAgY29uc29sZS5sb2coJz09PSBSRVNVTUlORyBFWFRSQUNUSU9OID09PScpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIFN0YXJ0IG5ldyBleHRyYWN0aW9uCiAgICAgICAgICAgIGV4dHJhY3Rpb25JblByb2dyZXNzID0gdHJ1ZTsKICAgICAgICAgICAgc2hvdWxkU3RvcCA9IGZhbHNlOwogICAgICAgICAgICBpc1BhdXNlZCA9IGZhbHNlOwogICAgICAgICAgICBleHRyYWN0ZWREYXRhID0gW107CiAgICAgICAgICAgIGN1cnJlbnRDYXJJbmRleCA9IDA7CiAgICAgICAgICAgIAogICAgICAgICAgICB1cGRhdGVTdGF0dXMoJ0ZpbmRpbmcgQ0FSIGxpbmtzLi4uJyk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBDbGVhciBwcmV2aW91cyByZXN1bHRzIGZpcnN0CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYXItcmVzdWx0cycpLmlubmVySFRNTCA9ICcnOwogICAgICAgICAgICAKICAgICAgICAgICAgY29uc29sZS5sb2coJz09PSBTVEFSVElORyBDQVIgTElOSyBERVRFQ1RJT04gPT09Jyk7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdQYWdlIFVSTDonLCB3aW5kb3cubG9jYXRpb24uaHJlZik7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdQYWdlIHRpdGxlOicsIGRvY3VtZW50LnRpdGxlKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGNhckxpbmtzID0gZmluZENhckxpbmtzKCk7CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAoY2FyTGlua3MubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgICAgICB1cGRhdGVTdGF0dXMoJ+KdjCBObyBDQVIgbGlua3MgZm91bmQgb24gdGhpcyBwYWdlJyk7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnPT09IE5PIExJTktTIEZPVU5EID09PScpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBleHRyYWN0aW9uSW5Qcm9ncmVzcyA9IGZhbHNlOwogICAgICAgICAgICAgICAgdXBkYXRlQnV0dG9uU3RhdGVzKCdpZGxlJyk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIHVwZGF0ZVN0YXR1cyhg4pyFIEZvdW5kICR7Y2FyTGlua3MubGVuZ3RofSBDQVJzLiBTdGFydGluZyB3aW5kb3ctYmFzZWQgZXh0cmFjdGlvbi4uLmApOwogICAgICAgICAgICBjb25zb2xlLmxvZygnPT09IFNUQVJUSU5HIEVYVFJBQ1RJT04gPT09Jyk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIFByb2Nlc3MgQ0FScyBzZXF1ZW50aWFsbHkgc3RhcnRpbmcgZnJvbSBjdXJyZW50Q2FySW5kZXgKICAgICAgICBmb3IgKGxldCBpID0gY3VycmVudENhckluZGV4OyBpIDwgY2FyTGlua3MubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKHNob3VsZFN0b3ApIHsKICAgICAgICAgICAgICAgIHVwZGF0ZVN0YXR1cygn4o+577iPIEV4dHJhY3Rpb24gc3RvcHBlZCBieSB1c2VyJyk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKGlzUGF1c2VkKSB7CiAgICAgICAgICAgICAgICBjdXJyZW50Q2FySW5kZXggPSBpOwogICAgICAgICAgICAgICAgdXBkYXRlU3RhdHVzKGDij7jvuI8gRXh0cmFjdGlvbiBwYXVzZWQgYXQgQ0FSICR7aSArIDF9LyR7Y2FyTGlua3MubGVuZ3RofWApOwogICAgICAgICAgICAgICAgdXBkYXRlQnV0dG9uU3RhdGVzKCdwYXVzZWQnKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgY3VycmVudENhckluZGV4ID0gaTsKICAgICAgICAgICAgY29uc29sZS5sb2coYPCflIQgUHJvY2Vzc2luZyBDQVIgJHtpICsgMX0vJHtjYXJMaW5rcy5sZW5ndGh9OiAke2NhckxpbmtzW2ldLmNhcklkfWApOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gUHJvY2VzcyBvbmUgQ0FSIGF0IGEgdGltZSBhbmQgd2FpdCBmb3IgY29tcGxldGlvbgogICAgICAgICAgICBhd2FpdCBwcm9jZXNzQ2FyTGluayhjYXJMaW5rc1tpXSwgaSwgY2FyTGlua3MubGVuZ3RoKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnNvbGUubG9nKGDinIUgQ29tcGxldGVkIHByb2Nlc3NpbmcgJHtjYXJMaW5rc1tpXS5jYXJJZH1gKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFNtYWxsIGRlbGF5IGJldHdlZW4gcmVxdWVzdHMgdG8gYmUgcmVzcGVjdGZ1bCBhbmQgcHJldmVudCBjb25mbGljdHMKICAgICAgICAgICAgaWYgKGkgPCBjYXJMaW5rcy5sZW5ndGggLSAxKSB7IC8vIERvbid0IGRlbGF5IGFmdGVyIHRoZSBsYXN0IENBUgogICAgICAgICAgICAgICAgYXdhaXQgbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIDIwMDApKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAKICAgICAgICBpZiAoIXNob3VsZFN0b3AgJiYgIWlzUGF1c2VkKSB7CiAgICAgICAgICAgIHVwZGF0ZVN0YXR1cyhg8J+OiSBFeHRyYWN0aW9uIGNvbXBsZXRlISBQcm9jZXNzZWQgJHtleHRyYWN0ZWREYXRhLmxlbmd0aH0gQ0FSc2ApOwogICAgICAgICAgICBjb25zb2xlLmxvZygnPT09IEVYVFJBQ1RJT04gQ09NUExFVEUgPT09Jyk7CiAgICAgICAgICAgIGV4dHJhY3Rpb25JblByb2dyZXNzID0gZmFsc2U7CiAgICAgICAgICAgIHVwZGF0ZUJ1dHRvblN0YXRlcygnY29tcGxldGVkJyk7CiAgICAgICAgfQogICAgfQoKICAgIC8vIEZ1bmN0aW9uIHRvIHBhdXNlIGV4dHJhY3Rpb24KICAgIGZ1bmN0aW9uIHBhdXNlRXh0cmFjdGlvbigpIHsKICAgICAgICBpc1BhdXNlZCA9IHRydWU7CiAgICAgICAgdXBkYXRlU3RhdHVzKGDij7jvuI8gUGF1c2luZyBleHRyYWN0aW9uIGFmdGVyIGN1cnJlbnQgQ0FSLi4uYCk7CiAgICAgICAgY29uc29sZS5sb2coJz09PSBQQVVTSU5HIEVYVFJBQ1RJT04gPT09Jyk7CiAgICB9CgogICAgLy8gRnVuY3Rpb24gdG8gc3RvcCBleHRyYWN0aW9uCiAgICBmdW5jdGlvbiBzdG9wRXh0cmFjdGlvbigpIHsKICAgICAgICBzaG91bGRTdG9wID0gdHJ1ZTsKICAgICAgICBpc1BhdXNlZCA9IGZhbHNlOwogICAgICAgIGV4dHJhY3Rpb25JblByb2dyZXNzID0gZmFsc2U7CiAgICAgICAgdXBkYXRlU3RhdHVzKCfij7nvuI8gU3RvcHBpbmcgZXh0cmFjdGlvbi4uLicpOwogICAgICAgIGNvbnNvbGUubG9nKCc9PT0gU1RPUFBJTkcgRVhUUkFDVElPTiA9PT0nKTsKICAgICAgICB1cGRhdGVCdXR0b25TdGF0ZXMoJ2lkbGUnKTsKICAgIH0KCiAgICAvLyBGdW5jdGlvbiB0byB1cGRhdGUgYnV0dG9uIHN0YXRlcwogICAgZnVuY3Rpb24gdXBkYXRlQnV0dG9uU3RhdGVzKHN0YXRlKSB7CiAgICAgICAgY29uc3Qgc3RhcnRCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3RhcnQtZXh0cmFjdGlvbi1idG4nKTsKICAgICAgICBjb25zdCBwYXVzZUJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYXVzZS1leHRyYWN0aW9uLWJ0bicpOwogICAgICAgIGNvbnN0IHN0b3BCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3RvcC1leHRyYWN0aW9uLWJ0bicpOwogICAgICAgIGNvbnN0IGV4cG9ydEJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdleHBvcnQtcmVzdWx0cy1idG4nKTsKICAgICAgICBjb25zdCBjbGVhckJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjbGVhci1yZXN1bHRzLWJ0bicpOwogICAgICAgIAogICAgICAgIHN3aXRjaCAoc3RhdGUpIHsKICAgICAgICAgICAgY2FzZSAnaWRsZSc6CiAgICAgICAgICAgICAgICBpZiAoc3RhcnRCdG4pIHsKICAgICAgICAgICAgICAgICAgICBzdGFydEJ0bi5kaXNhYmxlZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIHN0YXJ0QnRuLnRleHRDb250ZW50ID0gJ1N0YXJ0JzsKICAgICAgICAgICAgICAgICAgICBzdGFydEJ0bi5zdHlsZS5iYWNrZ3JvdW5kID0gJyMyOGE3NDUnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHBhdXNlQnRuKSBwYXVzZUJ0bi5kaXNhYmxlZCA9IHRydWU7CiAgICAgICAgICAgICAgICBpZiAoc3RvcEJ0bikgc3RvcEJ0bi5kaXNhYmxlZCA9IHRydWU7CiAgICAgICAgICAgICAgICBpZiAoZXhwb3J0QnRuKSBleHBvcnRCdG4uZGlzYWJsZWQgPSBleHRyYWN0ZWREYXRhLmxlbmd0aCA9PT0gMDsKICAgICAgICAgICAgICAgIGlmIChjbGVhckJ0bikgY2xlYXJCdG4uZGlzYWJsZWQgPSBmYWxzZTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGNhc2UgJ2V4dHJhY3RpbmcnOgogICAgICAgICAgICAgICAgaWYgKHN0YXJ0QnRuKSB7CiAgICAgICAgICAgICAgICAgICAgc3RhcnRCdG4uZGlzYWJsZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIHN0YXJ0QnRuLnRleHRDb250ZW50ID0gJ1J1bm5pbmcuLi4nOwogICAgICAgICAgICAgICAgICAgIHN0YXJ0QnRuLnN0eWxlLmJhY2tncm91bmQgPSAnIzZjNzU3ZCc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAocGF1c2VCdG4pIHBhdXNlQnRuLmRpc2FibGVkID0gZmFsc2U7CiAgICAgICAgICAgICAgICBpZiAoc3RvcEJ0bikgc3RvcEJ0bi5kaXNhYmxlZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgaWYgKGV4cG9ydEJ0bikgZXhwb3J0QnRuLmRpc2FibGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGlmIChjbGVhckJ0bikgY2xlYXJCdG4uZGlzYWJsZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgY2FzZSAncGF1c2VkJzoKICAgICAgICAgICAgICAgIGlmIChzdGFydEJ0bikgewogICAgICAgICAgICAgICAgICAgIHN0YXJ0QnRuLmRpc2FibGVkID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgc3RhcnRCdG4udGV4dENvbnRlbnQgPSAnUmVzdW1lJzsKICAgICAgICAgICAgICAgICAgICBzdGFydEJ0bi5zdHlsZS5iYWNrZ3JvdW5kID0gJyMxN2EyYjgnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHBhdXNlQnRuKSBwYXVzZUJ0bi5kaXNhYmxlZCA9IHRydWU7CiAgICAgICAgICAgICAgICBpZiAoc3RvcEJ0bikgc3RvcEJ0bi5kaXNhYmxlZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgaWYgKGV4cG9ydEJ0bikgZXhwb3J0QnRuLmRpc2FibGVkID0gZXh0cmFjdGVkRGF0YS5sZW5ndGggPT09IDA7CiAgICAgICAgICAgICAgICBpZiAoY2xlYXJCdG4pIGNsZWFyQnRuLmRpc2FibGVkID0gZmFsc2U7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICBjYXNlICdjb21wbGV0ZWQnOgogICAgICAgICAgICAgICAgaWYgKHN0YXJ0QnRuKSB7CiAgICAgICAgICAgICAgICAgICAgc3RhcnRCdG4uZGlzYWJsZWQgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICBzdGFydEJ0bi50ZXh0Q29udGVudCA9ICdTdGFydCc7CiAgICAgICAgICAgICAgICAgICAgc3RhcnRCdG4uc3R5bGUuYmFja2dyb3VuZCA9ICcjMjhhNzQ1JzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChwYXVzZUJ0bikgcGF1c2VCdG4uZGlzYWJsZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgaWYgKHN0b3BCdG4pIHN0b3BCdG4uZGlzYWJsZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgaWYgKGV4cG9ydEJ0bikgZXhwb3J0QnRuLmRpc2FibGVkID0gZXh0cmFjdGVkRGF0YS5sZW5ndGggPT09IDA7CiAgICAgICAgICAgICAgICBpZiAoY2xlYXJCdG4pIGNsZWFyQnRuLmRpc2FibGVkID0gZmFsc2U7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICB9CgogICAgLy8gRnVuY3Rpb24gdG8gY2xlYXIgcmVzdWx0cwogICAgZnVuY3Rpb24gY2xlYXJSZXN1bHRzKCkgewogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYXItcmVzdWx0cycpLmlubmVySFRNTCA9ICcnOwogICAgICAgIGV4dHJhY3RlZERhdGEgPSBbXTsKICAgICAgICBjdXJyZW50Q2FySW5kZXggPSAwOwogICAgICAgIGNhckxpbmtzID0gW107CiAgICAgICAgdXBkYXRlU3RhdHVzKCdSZXN1bHRzIGNsZWFyZWQgLSByZWFkeSBmb3IgbmV3IGV4dHJhY3Rpb24nKTsKICAgICAgICB1cGRhdGVCdXR0b25TdGF0ZXMoJ2lkbGUnKTsKICAgICAgICAKICAgICAgICAvLyBVcGRhdGUgcHJvZ3Jlc3MgaW5mbwogICAgICAgIHVwZGF0ZVByb2dyZXNzKDAsIDApOwogICAgfQoKICAgIC8vIEZ1bmN0aW9uIHRvIGRlYnVnIHRoZSBjdXJyZW50IHBhZ2UKICAgIGZ1bmN0aW9uIGRlYnVnUGFnZSgpIHsKICAgICAgICBjb25zb2xlLmxvZygnPT09IFBBR0UgREVCVUcgSU5GTyA9PT0nKTsKICAgICAgICBjb25zb2xlLmxvZygnVVJMOicsIHdpbmRvdy5sb2NhdGlvbi5ocmVmKTsKICAgICAgICBjb25zb2xlLmxvZygnVGl0bGU6JywgZG9jdW1lbnQudGl0bGUpOwogICAgICAgIAogICAgICAgIC8vIFNob3cgcGFnZSBzdHJ1Y3R1cmUKICAgICAgICBjb25zb2xlLmxvZygnVGFibGVzOicsIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ3RhYmxlJykubGVuZ3RoKTsKICAgICAgICBjb25zb2xlLmxvZygnUm93czonLCBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCd0cicpLmxlbmd0aCk7CiAgICAgICAgY29uc29sZS5sb2coJ0xpbmtzOicsIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ2EnKS5sZW5ndGgpOwogICAgICAgIAogICAgICAgIC8vIFNob3cgYWxsIENBUiByZWZlcmVuY2VzCiAgICAgICAgY29uc3QgcGFnZVRleHQgPSBkb2N1bWVudC5ib2R5LnRleHRDb250ZW50OwogICAgICAgIGNvbnN0IGNhck1hdGNoZXMgPSBwYWdlVGV4dC5tYXRjaCgvQ0FSLVxkKy9nKTsKICAgICAgICBjb25zb2xlLmxvZygnQ0FSIElEcyBmb3VuZDonLCBjYXJNYXRjaGVzKTsKICAgICAgICAKICAgICAgICAvLyBTaG93IGZpcnN0IDEwIGxpbmtzCiAgICAgICAgY29uc3QgbGlua3MgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdhJyk7CiAgICAgICAgY29uc29sZS5sb2coJ0ZpcnN0IDEwIGxpbmtzOicpOwogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgTWF0aC5taW4oMTAsIGxpbmtzLmxlbmd0aCk7IGkrKykgewogICAgICAgICAgICBjb25zb2xlLmxvZyhgICAke2kgKyAxfS4gIiR7bGlua3NbaV0udGV4dENvbnRlbnQudHJpbSgpfSIgLT4gJHtsaW5rc1tpXS5ocmVmfWApOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBUcnkgdG8gZmluZCB0aGUgc3BlY2lmaWMgbGlua3Mgd2UgbmVlZAogICAgICAgIGNvbnN0IHJlcG9ydExpbmtzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnYVtocmVmKj0iL1JlcG9ydGluZy9SZXBvcnQvSW5kZXgvIl0nKTsKICAgICAgICBjb25zb2xlLmxvZyhgUmVwb3J0L0luZGV4IGxpbmtzOiAke3JlcG9ydExpbmtzLmxlbmd0aH1gKTsKICAgICAgICByZXBvcnRMaW5rcy5mb3JFYWNoKChsaW5rLCBpKSA9PiB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGAgIFJlcG9ydCBsaW5rICR7aSArIDF9OiAke2xpbmsuaHJlZn1gKTsKICAgICAgICB9KTsKICAgICAgICAKICAgICAgICAvLyBMb29rIGZvciBrZW5kbyBncmlkIG9yIG90aGVyIGRhdGEgc3RydWN0dXJlcwogICAgICAgIGNvbnN0IGtlbmRvR3JpZHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuay1ncmlkLCBbZGF0YS1yb2xlPSJncmlkIl0nKTsKICAgICAgICBjb25zb2xlLmxvZygnS2VuZG8gZ3JpZHMgZm91bmQ6Jywga2VuZG9Hcmlkcy5sZW5ndGgpOwogICAgICAgIAogICAgICAgIGNvbnN0IHRhYmxlcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ3RhYmxlJyk7CiAgICAgICAgdGFibGVzLmZvckVhY2goKHRhYmxlLCBpKSA9PiB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBUYWJsZSAke2kgKyAxfTogY2xhc3M9IiR7dGFibGUuY2xhc3NOYW1lfSIsIGlkPSIke3RhYmxlLmlkfSIsIHJvd3M9JHt0YWJsZS5xdWVyeVNlbGVjdG9yQWxsKCd0cicpLmxlbmd0aH1gKTsKICAgICAgICB9KTsKICAgICAgICAKICAgICAgICB1cGRhdGVTdGF0dXMoJ0RlYnVnIGluZm8gbG9nZ2VkIHRvIGNvbnNvbGUgLSBwcmVzcyBGMTIgdG8gdmlldycpOwogICAgfQoKICAgIC8vIEZ1bmN0aW9uIHRvIGV4cG9ydCByZXN1bHRzCiAgICBmdW5jdGlvbiBleHBvcnRSZXN1bHRzKCkgewogICAgICAgIGlmIChleHRyYWN0ZWREYXRhLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICBhbGVydCgnTm8gZGF0YSB0byBleHBvcnQuIFBsZWFzZSBydW4gZXh0cmFjdGlvbiBmaXJzdC4nKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBjb25zb2xlLmxvZygnPT09IEVYUE9SVElORyBSRVNVTFRTID09PScpOwogICAgICAgIGNvbnNvbGUubG9nKGBFeHBvcnRpbmcgJHtleHRyYWN0ZWREYXRhLmxlbmd0aH0gcmVjb3Jkc2ApOwogICAgICAgIAogICAgICAgIC8vIENyZWF0ZSBDU1YgaGVhZGVyCiAgICAgICAgbGV0IGNzdkNvbnRlbnQgPSAnQ0FSIE5vLFJhaXNlZCBEYXRlLFN0YWdlIE93bmVyLFRhcmdldCBEYXRlLFN0YXR1cyxSZW1hcmtzXG4nOwogICAgICAgIAogICAgICAgIC8vIEFkZCBkYXRhIHJvd3MKICAgICAgICBsZXQgc3VjY2Vzc2Z1bEV4cG9ydHMgPSAwOwogICAgICAgIGV4dHJhY3RlZERhdGEuZm9yRWFjaCgoZGF0YSwgaW5kZXgpID0+IHsKICAgICAgICAgICAgaWYgKCFkYXRhLmVycm9yKSB7CiAgICAgICAgICAgICAgICBjb25zdCByb3cgPSBbCiAgICAgICAgICAgICAgICAgICAgZGF0YS5jYXJJZCB8fCAnJywKICAgICAgICAgICAgICAgICAgICBkYXRhLnJhaXNlZERhdGUgfHwgJycsCiAgICAgICAgICAgICAgICAgICAgZGF0YS5zdGFnZU93bmVyIHx8ICcnLAogICAgICAgICAgICAgICAgICAgIGRhdGEudGFyZ2V0RGF0ZSB8fCAnJywKICAgICAgICAgICAgICAgICAgICBkYXRhLnN0YXR1cyB8fCAnJywKICAgICAgICAgICAgICAgICAgICBkYXRhLnJlbWFya3MgfHwgJycKICAgICAgICAgICAgICAgIF0ubWFwKGZpZWxkID0+IHsKICAgICAgICAgICAgICAgICAgICAvLyBFc2NhcGUgcXVvdGVzIGFuZCB3cmFwIGluIHF1b3RlcwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGVzY2FwZWQgPSBTdHJpbmcoZmllbGQpLnJlcGxhY2UoLyIvZywgJyIiJyk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGAiJHtlc2NhcGVkfSJgOwogICAgICAgICAgICAgICAgfSkuam9pbignLCcpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjc3ZDb250ZW50ICs9IHJvdyArICdcbic7CiAgICAgICAgICAgICAgICBzdWNjZXNzZnVsRXhwb3J0cysrOwogICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFJvdyAke2luZGV4ICsgMX06ICR7ZGF0YS5jYXJJZH0gLSAke2RhdGEuc3RhZ2VPd25lcn0gLSAke2RhdGEucmVtYXJrc31gKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBTa2lwcGluZyByb3cgJHtpbmRleCArIDF9IGR1ZSB0byBlcnJvcjogJHtkYXRhLmVycm9yfWApOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgCiAgICAgICAgY29uc29sZS5sb2coYFN1Y2Nlc3NmdWxseSBleHBvcnRlZCAke3N1Y2Nlc3NmdWxFeHBvcnRzfSByb3dzIG91dCBvZiAke2V4dHJhY3RlZERhdGEubGVuZ3RofSB0b3RhbGApOwogICAgICAgIAogICAgICAgIC8vIENyZWF0ZSBhbmQgZG93bmxvYWQgdGhlIGZpbGUKICAgICAgICB0cnkgewogICAgICAgICAgICBjb25zdCBibG9iID0gbmV3IEJsb2IoW2NzdkNvbnRlbnRdLCB7IHR5cGU6ICd0ZXh0L2NzdjtjaGFyc2V0PXV0Zi04OycgfSk7CiAgICAgICAgICAgIGNvbnN0IHVybCA9IHdpbmRvdy5VUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpOwogICAgICAgICAgICBjb25zdCBhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpOwogICAgICAgICAgICBhLmhyZWYgPSB1cmw7CiAgICAgICAgICAgIGEuZG93bmxvYWQgPSBgY2FyX2RhdGFfJHtuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkuc3BsaXQoJ1QnKVswXX1fJHtuZXcgRGF0ZSgpLnRvVGltZVN0cmluZygpLnNwbGl0KCcgJylbMF0ucmVwbGFjZSgvOi9nLCAnJyl9LmNzdmA7CiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoYSk7CiAgICAgICAgICAgIGEuY2xpY2soKTsKICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChhKTsKICAgICAgICAgICAgd2luZG93LlVSTC5yZXZva2VPYmplY3RVUkwodXJsKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIHVwZGF0ZVN0YXR1cyhg4pyFIEV4cG9ydGVkICR7c3VjY2Vzc2Z1bEV4cG9ydHN9IENBUnMgdG8gQ1NWIGZpbGVgKTsKICAgICAgICAgICAgY29uc29sZS5sb2coJz09PSBFWFBPUlQgQ09NUExFVEUgPT09Jyk7CiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgY29uc29sZS5lcnJvcignRXhwb3J0IGVycm9yOicsIGVycm9yKTsKICAgICAgICAgICAgYWxlcnQoJ0Vycm9yIGV4cG9ydGluZyBkYXRhLiBQbGVhc2UgY2hlY2sgY29uc29sZSBmb3IgZGV0YWlscy4nKTsKICAgICAgICAgICAgdXBkYXRlU3RhdHVzKCfinYwgRXhwb3J0IGZhaWxlZCcpOwogICAgICAgIH0KICAgIH0KCiAgICAvLyBJbml0aWFsaXplIHRoZSBVSSB3aGVuIHRoZSBwYWdlIGxvYWRzCiAgICBhc3luYyBmdW5jdGlvbiBpbml0KCkgewogICAgICAgIGNvbnNvbGUubG9nKCdJbml0aWFsaXppbmcgQ0FSIEJhdGNoIEV4dHJhY3Rvci4uLicpOwogICAgICAgIGNvbnNvbGUubG9nKCdDdXJyZW50IFVSTDonLCB3aW5kb3cubG9jYXRpb24uaHJlZik7CiAgICAgICAgCiAgICAgICAgLy8gRmlyc3QsIHZlcmlmeSBhY2Nlc3MgYmVmb3JlIGRvaW5nIGFueXRoaW5nIGVsc2UKICAgICAgICBjb25zdCBhY2Nlc3NSZXN1bHQgPSBhd2FpdCB2ZXJpZnlBY2Nlc3MoKTsKICAgICAgICAKICAgICAgICBpZiAoIWFjY2Vzc1Jlc3VsdC5hdXRob3JpemVkKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdBY2Nlc3MgZGVuaWVkOicsIGFjY2Vzc1Jlc3VsdC5yZWFzb24pOwogICAgICAgICAgICBzaG93QWNjZXNzRGVuaWVkTWVzc2FnZShhY2Nlc3NSZXN1bHQucmVhc29uLCBhY2Nlc3NSZXN1bHQubWVzc2FnZSk7CiAgICAgICAgICAgIHJldHVybjsgLy8gU3RvcCBpbml0aWFsaXphdGlvbgogICAgICAgIH0KICAgICAgICAKICAgICAgICBjb25zb2xlLmxvZygnQWNjZXNzIGdyYW50ZWQgZm9yIGRldmljZSBmaW5nZXJwcmludDonLCB1c2VyRmluZ2VycHJpbnQpOwogICAgICAgIHNob3dBY2Nlc3NTdGF0dXMoKTsKICAgICAgICAKICAgICAgICAvLyBDaGVjayBpZiB3ZSdyZSBvbiBhIENBUiBkZXRhaWxzIHBhZ2UgKGhhcyAjIS9kZXRhaWxzKQogICAgICAgIGlmICh3aW5kb3cubG9jYXRpb24uaHJlZi5pbmNsdWRlcygnIyEvZGV0YWlscycpKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdEZXRlY3RlZCBDQVIgZGV0YWlscyBwYWdlJyk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBDaGVjayBpZiB0aGlzIGlzIGEgcG9wdXAgd2luZG93IGZvciBkYXRhIGV4dHJhY3Rpb24KICAgICAgICAgICAgaWYgKHdpbmRvdy5vcGVuZXIpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdUaGlzIGlzIGEgcG9wdXAgd2luZG93LCBoYW5kbGluZyBkYXRhIGV4dHJhY3Rpb24uLi4nKTsKICAgICAgICAgICAgICAgIGhhbmRsZUNhckRldGFpbHNXaW5kb3coKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdUaGlzIGlzIG5vdCBhIHBvcHVwIHdpbmRvdywgc2tpcHBpbmcgZXh0cmFjdGlvbicpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIENoZWNrIGlmIHdlJ3JlIG9uIHRoZSBtYWluIENBUiBsaXN0IHBhZ2UKICAgICAgICBpZiAod2luZG93LmxvY2F0aW9uLmhyZWYuaW5jbHVkZXMoJy9SZXBvcnRpbmcvUmVwb3J0aW5nTWFuYWdlbWVudCcpKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdEZXRlY3RlZCBDQVIgbGlzdCBwYWdlJyk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBXYWl0IGZvciB0aGUgcGFnZSB0byBiZSBmdWxseSBsb2FkZWQKICAgICAgICAgICAgaWYgKGRvY3VtZW50LnJlYWR5U3RhdGUgPT09ICdsb2FkaW5nJykgewogICAgICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsICgpID0+IHsKICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRlVUkoKTsKICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlQnV0dG9uU3RhdGVzKCdpZGxlJyk7IC8vIEluaXRpYWxpemUgYnV0dG9uIHN0YXRlcwogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2V0IHVwIHBlcmlvZGljIGFjY2VzcyBjaGVja3MKICAgICAgICAgICAgICAgICAgICAgICAgc2V0SW50ZXJ2YWwoYXN5bmMgKCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVjaGVja1Jlc3VsdCA9IGF3YWl0IHZlcmlmeUFjY2VzcygpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFyZWNoZWNrUmVzdWx0LmF1dGhvcml6ZWQgJiYgaXNBdXRob3JpemVkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQWNjZXNzIHdhcyByZXZva2VkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0FjY2VzcyByZXZva2VkIGR1cmluZyBzZXNzaW9uJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvd0FjY2Vzc0RlbmllZE1lc3NhZ2UocmVjaGVja1Jlc3VsdC5yZWFzb24sIHJlY2hlY2tSZXN1bHQubWVzc2FnZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gSGlkZSB0aGUgVUkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByaWJib24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2FyLWV4dHJhY3Rvci1yaWJib24nKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmliYm9uKSByaWJib24uc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTdG9wIGFueSBvbmdvaW5nIGV4dHJhY3Rpb24KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdG9wRXh0cmFjdGlvbigpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9LCBDSEVDS19JTlRFUlZBTCk7CiAgICAgICAgICAgICAgICAgICAgfSwgMTAwMCk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIGNyZWF0ZVVJKCk7CiAgICAgICAgICAgICAgICAgICAgdXBkYXRlQnV0dG9uU3RhdGVzKCdpZGxlJyk7IC8vIEluaXRpYWxpemUgYnV0dG9uIHN0YXRlcwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIFNldCB1cCBwZXJpb2RpYyBhY2Nlc3MgY2hlY2tzCiAgICAgICAgICAgICAgICAgICAgc2V0SW50ZXJ2YWwoYXN5bmMgKCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByZWNoZWNrUmVzdWx0ID0gYXdhaXQgdmVyaWZ5QWNjZXNzKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcmVjaGVja1Jlc3VsdC5hdXRob3JpemVkICYmIGlzQXV0aG9yaXplZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQWNjZXNzIHdhcyByZXZva2VkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnQWNjZXNzIHJldm9rZWQgZHVyaW5nIHNlc3Npb24nKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNob3dBY2Nlc3NEZW5pZWRNZXNzYWdlKHJlY2hlY2tSZXN1bHQucmVhc29uLCByZWNoZWNrUmVzdWx0Lm1lc3NhZ2UpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBIaWRlIHRoZSBVSQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmliYm9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Nhci1leHRyYWN0b3ItcmliYm9uJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmliYm9uKSByaWJib24uc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU3RvcCBhbnkgb25nb2luZyBleHRyYWN0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdG9wRXh0cmFjdGlvbigpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwgQ0hFQ0tfSU5URVJWQUwpOwogICAgICAgICAgICAgICAgfSwgMTAwMCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLy8gU3RhcnQgdGhlIGluaXRpYWxpemF0aW9uCiAgICBpbml0KCk7Cgp9KSgpOwo=';try{eval(atob(_0x));}catch(e){console.error('Load error:',e.message);}})();